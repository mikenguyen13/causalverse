<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2. Difference-in-Differences • causalverse</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2. Difference-in-Differences">
<meta property="og:description" content="causalverse">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">causalverse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/did.html">2. Difference-in-Differences</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction to CausalVerse</a>
    </li>
    <li>
      <a href="../articles/model_free.html">Model Free Evidence</a>
    </li>
    <li>
      <a href="../articles/synthdid.html">3. Synthetic Difference-in-Differences</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>2. Difference-in-Differences</h1>
                        <h4 data-toc-skip class="author">Mike
Nguyen</h4>
            
            <h4 data-toc-skip class="date">2024-01-08</h4>
      
      
      <div class="hidden name"><code>did.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">causalverse</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.2     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.4</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.4.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.2     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span></code></pre></div>
<div class="section level2">
<h2 id="assumptions">Assumptions<a class="anchor" aria-label="anchor" href="#assumptions"></a>
</h2>
<div class="section level3">
<h3 id="treatment-variation-plot">Treatment Variation Plot<a class="anchor" aria-label="anchor" href="#treatment-variation-plot"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">PanelMatch</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/" class="external-link">fixest</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/PanelMatch/man/DisplayTreatment.html" class="external-link">DisplayTreatment</a></span><span class="op">(</span></span>
<span>    unit.id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>    time.id <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>    <span class="co"># legend.position = "none",</span></span>
<span>    xlab <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"Unit"</span>,</span>
<span>    <span class="co"># hide.x.tick.label = TRUE, </span></span>
<span>    hide.y.tick.label <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="co"># dense.plot = TRUE,</span></span>
<span>    treatment <span class="op">=</span> <span class="st">"treat"</span>,</span>
<span>    data <span class="op">=</span> <span class="fu">fixest</span><span class="fu">::</span><span class="va"><a href="https://lrberge.github.io/fixest/reference/base_stagg.html" class="external-link">base_stagg</a></span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treat <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">time_to_treatment</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="did_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>It’s okay to have some units without any observation on the left-hand
side (i.e., left-censored).</p>
</div>
<div class="section level3">
<h3 id="pre-treatment-parallel-trends">Pre-treatment Parallel Trends<a class="anchor" aria-label="anchor" href="#pre-treatment-parallel-trends"></a>
</h3>
<div class="section level4">
<h4 id="plot_par_trends">plot_par_trends<a class="anchor" aria-label="anchor" href="#plot_par_trends"></a>
</h4>
<p>The <code>plot_par_trends</code> function is designed to assist
researchers and analysts in visualizing parallel trends in longitudinal
datasets, particularly for datasets with treatment and control groups.
This tool makes it easy to visualize changes over time for various
outcome metrics between the groups.</p>
<p><strong>Data Structure</strong></p>
<p>For optimal use of <code>plot_par_trends</code>, ensure your data is
structured in the following manner:</p>
<ul>
<li>
<code>entity</code>: A unique identifier for each observation (e.g.,
individuals, companies).</li>
<li>
<code>time</code>: The time period for the observation.</li>
<li>Treatment status column: Distinguishing treated observations from
controls.</li>
<li>Metric columns: Capturing the outcome measures of interest.</li>
</ul>
<p><strong>Sample Data Generation</strong></p>
<p>For demonstration purposes, we can generate some illustrative
data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>entity <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">entity</span>, <span class="va">time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">entity</span> <span class="op">&lt;=</span> <span class="fl">50</span>, <span class="st">"Treated"</span>, <span class="st">"Control"</span><span class="op">)</span>,</span>
<span>    outcome1 <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">"Treated"</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    outcome2 <span class="op">=</span> <span class="fl">3</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="va">time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">"Treated"</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    outcome3 <span class="op">=</span> <span class="fl">3</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">time</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, rate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">"Treated"</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, </span>
<span>    outcome4 <span class="op">=</span> <span class="va">time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">"Treated"</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   entity time treatment   outcome1 outcome2 outcome3   outcome4</span></span>
<span><span class="co">#&gt; 1      1    1   Treated -4.6811537 3.805660 3.338545 -0.7753409</span></span>
<span><span class="co">#&gt; 2      1    2   Treated -0.8810304 3.292848 7.183620  2.4547248</span></span>
<span><span class="co">#&gt; 3      1    3   Treated  2.2930287 4.430837 3.327542  2.0859113</span></span>
<span><span class="co">#&gt; 4      1    4   Treated -0.3440152 5.163441 6.469421  4.1430309</span></span>
<span><span class="co">#&gt; 5      1    5   Treated  0.6635218 5.420341 1.702134  3.0329169</span></span>
<span><span class="co">#&gt; 6      1    6   Treated -0.2187910 5.427507 2.382530  7.0894805</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;      entity            time       treatment            outcome1     </span></span>
<span><span class="co">#&gt;  Min.   :  1.00   Min.   : 1.0   Length:1000        Min.   :-6.901  </span></span>
<span><span class="co">#&gt;  1st Qu.: 25.75   1st Qu.: 3.0   Class :character   1st Qu.: 1.028  </span></span>
<span><span class="co">#&gt;  Median : 50.50   Median : 5.5   Mode  :character   Median : 2.777  </span></span>
<span><span class="co">#&gt;  Mean   : 50.50   Mean   : 5.5                      Mean   : 2.757  </span></span>
<span><span class="co">#&gt;  3rd Qu.: 75.25   3rd Qu.: 8.0                      3rd Qu.: 4.425  </span></span>
<span><span class="co">#&gt;  Max.   :100.00   Max.   :10.0                      Max.   :10.134  </span></span>
<span><span class="co">#&gt;     outcome2         outcome3         outcome4     </span></span>
<span><span class="co">#&gt;  Min.   : 1.207   Min.   :-6.802   Min.   :-1.678  </span></span>
<span><span class="co">#&gt;  1st Qu.: 4.581   1st Qu.: 3.022   1st Qu.: 4.945  </span></span>
<span><span class="co">#&gt;  Median : 5.661   Median : 4.928   Median : 7.639  </span></span>
<span><span class="co">#&gt;  Mean   : 5.671   Mean   : 5.019   Mean   : 7.559  </span></span>
<span><span class="co">#&gt;  3rd Qu.: 6.798   3rd Qu.: 6.865   3rd Qu.:10.087  </span></span>
<span><span class="co">#&gt;  Max.   :10.186   Max.   :23.468   Max.   :16.779</span></span></code></pre></div>
<p>Visualizing Trends with <code>plot_par_trends</code> Invoke the
<code>plot_par_trends</code> function using the sample data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_par_trends.html">plot_par_trends</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  metrics_and_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    outcome1 <span class="op">=</span> <span class="st">"Outcome 1"</span>,</span>
<span>    outcome2 <span class="op">=</span> <span class="st">"Outcome 2"</span>,</span>
<span>    outcome3 <span class="op">=</span> <span class="st">"Outcome 3"</span>,</span>
<span>    outcome4 <span class="op">=</span> <span class="st">"Outcome 4"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  treatment_status_var <span class="op">=</span> <span class="st">"treatment"</span>,</span>
<span>  time_var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>time <span class="op">=</span> <span class="st">"Time"</span><span class="op">)</span>,</span>
<span>  smoothing_method <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>  theme_use <span class="op">=</span> <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/ama_theme.html">ama_theme</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span>  <span class="co"># title_prefix = "Para Trends"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Note</strong>: This custom function is built based on the
<code>geom_smooth</code> function from ggplot2. Therefore, it supports
most of the smoothing methods you’d find in ggplot2, such as
<code>lm</code>, <code>glm</code>, <code>loess</code>, etc.</p>
<p>The function returns a list of ggplot objects, which can be
visualized using tools like <code>gridExtra</code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'gridExtra'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     combine</span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">results</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="did_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p><strong>Note of Caution</strong>: When using this custom package,
it’s crucial to carefully examine parallel trends plots both with and
without control variables. At times, one might observe suitable parallel
trends without control variables. However, when these control variables
are introduced, the underlying assumptions can be disturbed. Conversely,
there are cases where the general parallel trends assumption doesn’t
seem to be in place, but when conditioned on the control variables, the
trends align perfectly. This package provides functions that allow users
to easily generate these plots side by side, especially after
formulating the predicted values of dependent variables by accounting
for control variables. Always approach these plots with a discerning eye
to ensure accurate interpretation and application.</p>
<p>In this demonstration, I’ve incorporated the use of the smoothing
function to illustrate its potential application. It’s imperative,
however, to approach this function with prudence. Although the smoothing
function can be invaluable in revealing underlying trends in specific
scenarios, its application carries inherent risks. One such risk is the
inadvertent or intentional misrepresentation of data, leading observers
to falsely deduce the presence of parallel trends where they might not
exist. This can potentially skew interpretations and lead to incorrect
conclusions.</p>
<p>Given these concerns, if you’re inclined to utilize the smoothing
function, it’s paramount to also consider the implications and insights
from our secondary plot. This subsequent visualization offers a more
granular and statistically sound perspective, specifically focusing on
the pre-treatment disparities between the treated and control groups. It
serves as a vital counterbalance, ensuring that any trend
interpretations are grounded in robust statistical analysis.</p>
</div>
<div class="section level4">
<h4 id="plot_coef_par_trends">plot_coef_par_trends<a class="anchor" aria-label="anchor" href="#plot_coef_par_trends"></a>
</h4>
<p>Arguments</p>
<ul>
<li>
<code>data</code>: A data frame containing the data to be used in
the model.</li>
<li>
<code>dependent_vars</code>: A named list of dependent variables to
model along with their respective labels.</li>
<li>
<code>time_var</code>: The name of the time variable in the
data.</li>
<li>(similarly, describe other arguments…)</li>
</ul>
<p>Output</p>
<p>The function returns a plot or a list of plots visualizing
interaction coefficients based on user specifications.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/" class="external-link">fixest</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"base_did"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combined Plot</span></span>
<span><span class="va">combined_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coef_par_trends.html">plot_coef_par_trends</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">base_did</span>,</span>
<span>  dependent_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Outcome 1"</span>, x1 <span class="op">=</span> <span class="st">"Outcome 2"</span><span class="op">)</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"period"</span>,</span>
<span>  unit_treatment_status <span class="op">=</span> <span class="st">"treat"</span>,</span>
<span>  unit_id_var <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  plot_type <span class="op">=</span> <span class="st">"coefplot"</span>,</span>
<span>  combined_plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"Interaction coefficients Plot"</span><span class="op">)</span>,</span>
<span>  legend_title <span class="op">=</span> <span class="st">"Metrics"</span>,</span>
<span>  legend_position <span class="op">=</span> <span class="st">"bottomright"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Notes from the estimations:</span></span>
<span><span class="co">#&gt; [x 2] The variable 'period::10:treat' has been removed because of collinearity (see $collin.var).</span></span></code></pre></div>
<p><img src="did_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Individual Plots</span></span>
<span><span class="va">indi_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coef_par_trends.html">plot_coef_par_trends</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">base_did</span>,</span>
<span>  dependent_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Outcome 1"</span>, x1 <span class="op">=</span> <span class="st">"Outcome 2"</span><span class="op">)</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"period"</span>,</span>
<span>  unit_treatment_status <span class="op">=</span> <span class="st">"treat"</span>,</span>
<span>  unit_id_var <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  plot_type <span class="op">=</span> <span class="st">"coefplot"</span>,</span>
<span>  combined_plot <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; The variable 'period::10:treat' has been removed because of collinearity (see $collin.var).</span></span>
<span><span class="co">#&gt; The variable 'period::10:treat' has been removed because of collinearity (see $collin.var).</span></span></code></pre></div>
<p><img src="did_files/figure-html/unnamed-chunk-6-2.png" width="700"><img src="did_files/figure-html/unnamed-chunk-6-3.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="random-treatment-assignments">Random Treatment Assignments<a class="anchor" aria-label="anchor" href="#random-treatment-assignments"></a>
</h2>
<p>In Difference-in-Differences analysis, ensuring randomness in
treatment assignment is crucial. This randomization comes in two main
levels: random time assignment and random unit assignment.</p>
<ol style="list-style-type: decimal">
<li>
<p><a href="#random-time-assignment">Random Time Assignment</a></p>
<ul>
<li><p><strong>Definition:</strong> This pertains to when (in time) a
treatment or intervention is introduced, not to which units it’s
introduced.</p></li>
<li><p><strong>Importance in Staggered DiD or Rollout Design:</strong>
If certain periods are predisposed to receiving treatment (e.g.,
economic booms or downturns), then the estimated treatment effect can
get confounded with these period-specific shocks. A truly random time
assignment ensures that the treatment’s introduction isn’t
systematically related to other time-specific factors.</p></li>
<li><p><strong>Example:</strong> Suppose there’s a policy aimed at
improving infrastructure. If this policy tends to get introduced during
economic booms because that’s when governments have surplus funds, then
it’s challenging to disentangle the effects of the booming economy from
the effects of the infrastructure policy. A random time assignment would
ensure the policy’s introduction isn’t tied to the state of the
economy.</p></li>
</ul>
</li>
<li>
<p><a href="#random-unit-assignment">Random Unit Assignment</a></p>
<ul>
<li><p><strong>Definition:</strong> This pertains to which units (like
individuals, firms, or regions) are chosen to receive the
treatment.</p></li>
<li><p><strong>Example:</strong> Using the same infrastructure policy,
if it is always introduced in wealthier regions first, then the effects
of regional affluence can get confounded with the policy effects. Random
unit assignment ensures the policy isn’t systematically introduced to
certain kinds of regions.</p></li>
</ul>
</li>
</ol>
<p><strong>Providing Evidence of Random Treatment
Assignments:</strong></p>
<p>To validate the DiD design, evidence should be provided for both
random time and random unit assignments:</p>
<ul>
<li>
<p><strong>For <a href="#random-time-assignment">Random Time
Assignment</a>:</strong></p>
<ul>
<li><p><strong>Graphical Analysis:</strong> Plot the timing of treatment
introduction across various periods. A discernible pattern (like always
introducing a policy before election years) can raise concerns.</p></li>
<li><p><strong>Narrative Evidence:</strong> Historical context might
indicate that the timing of treatment introduction was exogenous. For
example, if a policy’s rollout timing was determined by some external
random event, that would support random time assignment.</p></li>
</ul>
</li>
<li>
<p><strong>For <a href="#random-unit-assignment">Random Unit
Assignment</a>:</strong></p>
<ul>
<li><p><strong>Statistical Tests:</strong> Conduct tests to demonstrate
that pre-treatment characteristics are balanced between the treated and
control groups. Techniques like t-tests or regressions can be used for
this.</p></li>
<li><p><strong>Narrative Evidence:</strong> Institutional or historical
data might show that the selection of specific units for treatment was
random.</p></li>
</ul>
</li>
</ul>
<div class="section level3">
<h3 id="random-time-assignment">Random Time Assignment<a class="anchor" aria-label="anchor" href="#random-time-assignment"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Control number of units and time periods here</span></span>
<span><span class="va">num_units</span>   <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span><span class="va">num_periods</span> <span class="op">&lt;-</span> <span class="fl">20</span>  </span>
<span></span>
<span><span class="co"># Setting seed for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate data for given number of units over specified periods</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>unit <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_units</span>,</span>
<span>                    time_period <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_periods</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">treatment_random</span>     <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">treatment_systematic</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Randomly assigning treatment times to units</span></span>
<span><span class="va">random_treatment_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num_periods</span>, <span class="va">num_units</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_units</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">treatment_random</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">unit</span> <span class="op">==</span> <span class="va">i</span> <span class="op">&amp;</span></span>
<span>                          <span class="va">data</span><span class="op">$</span><span class="va">time_period</span> <span class="op">==</span> <span class="va">random_treatment_times</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Calculate peaks robustly</span></span>
<span><span class="va">peak_periods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span> <span class="op">*</span> <span class="va">num_periods</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Systematic treatment assignment with higher probability at peak periods</span></span>
<span><span class="va">prob_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">num_periods</span>, <span class="va">num_periods</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Update the probability for peak periods; </span></span>
<span><span class="co"># the rest will have a slightly reduced probability</span></span>
<span><span class="va">higher_prob</span> <span class="op">&lt;-</span> <span class="fl">0.10</span>  <span class="co"># Arbitrary, adjust as necessary</span></span>
<span><span class="va">prob_values</span><span class="op">[</span><span class="va">peak_periods</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">higher_prob</span></span>
<span><span class="va">adjustment</span> <span class="op">&lt;-</span></span>
<span>  <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">peak_periods</span><span class="op">)</span> <span class="op">*</span> <span class="va">higher_prob</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">peak_periods</span><span class="op">)</span> <span class="op">/</span> <span class="va">num_periods</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">num_periods</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">peak_periods</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">prob_values</span><span class="op">[</span><span class="op">-</span><span class="va">peak_periods</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">num_periods</span> <span class="op">-</span> <span class="va">adjustment</span></span>
<span></span>
<span><span class="va">systematic_treatment_times</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num_periods</span>, <span class="va">num_units</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="va">prob_values</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_units</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">treatment_systematic</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">unit</span> <span class="op">==</span> <span class="va">i</span> <span class="op">&amp;</span></span>
<span>                              <span class="va">data</span><span class="op">$</span><span class="va">time_period</span> <span class="op">==</span> <span class="va">systematic_treatment_times</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">unit</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   unit time_period treatment_random treatment_systematic</span></span>
<span><span class="co">#&gt; 1    1           1                0                    0</span></span>
<span><span class="co">#&gt; 2    1           2                0                    0</span></span>
<span><span class="co">#&gt; 3    1           3                0                    0</span></span>
<span><span class="co">#&gt; 4    1           4                0                    0</span></span>
<span><span class="co">#&gt; 5    1           5                0                    0</span></span>
<span><span class="co">#&gt; 6    1           6                0                    0</span></span>
<span></span>
<span><span class="co"># Plotting</span></span>
<span><span class="va">plot_random</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/plot_treat_time.html">plot_treat_time</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">data</span>,</span>
<span>    time_var <span class="op">=</span> <span class="va">time_period</span>,</span>
<span>    unit_treat <span class="op">=</span> <span class="va">treatment_random</span>,</span>
<span>    theme_use <span class="op">=</span> <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/ama_theme.html">ama_theme</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    show_legend <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">plot_systematic</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/plot_treat_time.html">plot_treat_time</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">data</span>,</span>
<span>    time_var <span class="op">=</span> <span class="va">time_period</span>,</span>
<span>    unit_treat <span class="op">=</span> <span class="va">treatment_systematic</span>,</span>
<span>    theme_use <span class="op">=</span> <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/ama_theme.html">ama_theme</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    show_legend <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">plot_random</span>, <span class="va">plot_systematic</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="did_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p><strong>Random Time Assignment Plot:</strong></p>
<ul>
<li>Treatment is dispersed randomly across time periods, with no clear
pattern.</li>
</ul>
<p><strong>Systematic Time Assignment Plot:</strong></p>
<ul>
<li>Distinct peaks are observed at the 25th, 50th, and 75th periods,
indicating non-random treatment assignment at these times.</li>
</ul>
<p><strong>Interpretation:</strong> The random plot shows arbitrary
treatment assignments, while the systematic plot reveals consistent
periods where more units receive treatment. This systematic behavior can
introduce bias in causal studies.</p>
</div>
<div class="section level3">
<h3 id="random-unit-assignment">Random Unit Assignment<a class="anchor" aria-label="anchor" href="#random-unit-assignment"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<p><strong>For a Single Pre-treatment Characteristic:</strong></p>
<ul>
<li>
<strong>T-test:</strong> This is used for comparing means of the
characteristic between two groups (treated vs. control). If the p-value
is significant (typically &lt; 0.05), it suggests the groups differ on
that characteristic.</li>
</ul>
</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data &lt;- data.frame(treatment = c(rep(0, 50), rep(1, 50)),</span></span>
<span><span class="co">#                    # Dummy for treatment</span></span>
<span><span class="co">#                    characteristic = rnorm(100) # Randomly generated characteristic</span></span>
<span><span class="co">#                    )</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="va">mtcars</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="va">cyl</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span>, replace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span>                   </span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">treatment</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  mpg by treatment</span></span>
<span><span class="co">#&gt; t = 0.81508, df = 29.976, p-value = 0.4215</span></span>
<span><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span><span class="co">#&gt;  -2.575206  5.995841</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span><span class="co">#&gt;        20.83889        19.12857</span></span></code></pre></div>
<ul>
<li>
<strong>Regression:</strong> Run a regression of the pre-treatment
characteristic on the treatment dummy. If the coefficient on the
treatment dummy is significant, it suggests the groups differ on that
characteristic. The regression can be specified as:</li>
</ul>
<p><span class="math display">\[
Characteristic_i = \alpha + \beta \times Treatment_i + \epsilon_i
\]</span></p>
<p>where <span class="math inline">\(Characteristic_i\)</span> is the
pre-treatment characteristic of unit <span class="math inline">\(i\)</span> and <span class="math inline">\(Treatment_i\)</span> is a dummy variable which
equals 1 if <span class="math inline">\(unit_i\)</span> is treated and 0
otherwise.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">treatment</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_result</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = mpg ~ treatment, data = data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -10.439  -4.529  -1.179   2.271  13.061 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   20.839      1.429  14.581 3.72e-15 ***</span></span>
<span><span class="co">#&gt; treatment     -1.710      2.161  -0.792    0.435    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 6.064 on 30 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.02046,    Adjusted R-squared:  -0.01219 </span></span>
<span><span class="co">#&gt; F-statistic: 0.6265 on 1 and 30 DF,  p-value: 0.4348</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><strong>For Multiple Pre-treatment Characteristics:</strong></li>
</ol>
<p><strong>Visualization</strong></p>
<ul>
<li>For both single and multiple characteristics, it can be useful to
visualize the distributions in both groups. Histograms, kernel density
plots, or box plots can be employed to visually assess balance.</li>
<li>It’s important to note that you should consider the pre-treatment
periods.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rlang.r-lib.org" class="external-link">rlang</a></span><span class="op">)</span> </span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'rlang'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:purrr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     %@%, flatten, flatten_chr, flatten_dbl, flatten_int, flatten_lgl,</span></span>
<span><span class="co">#&gt;     flatten_raw, invoke, splice</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Density distribution for a single characteristic</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mpg</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Density Distribution by Treatment Group"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/ama_theme.html">ama_theme</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="did_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Side-by-side density distributions for multiple characteristics</span></span>
<span><span class="va">plot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_density_by_treatment.html">plot_density_by_treatment</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  var_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"mpg"</span> <span class="op">=</span> <span class="st">"Var 1"</span>,</span>
<span>                 <span class="st">"cyl"</span> <span class="op">=</span> <span class="st">"Var 2"</span><span class="op">)</span>,</span>
<span>  treatment_var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"treatment"</span> <span class="op">=</span> <span class="st">"Treatment Name\nin Legend"</span><span class="op">)</span>,</span>
<span>  theme_use <span class="op">=</span> <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/ama_theme.html">ama_theme</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">plot_list</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="did_files/figure-html/unnamed-chunk-10-2.png" width="700"></p>
<p><strong>Multivariate Regression</strong></p>
<p>Run a regression of each pre-treatment characteristic on the
treatment dummy. This allows for the simultaneous assessment of balance
on multiple characteristics. You can include all characteristics in a
single regression as dependent variables.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_multivariate</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="va">cyl</span><span class="op">)</span> <span class="op">~</span> <span class="va">treatment</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_multivariate</span><span class="op">)</span></span>
<span><span class="co">#&gt; Response mpg :</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = mpg ~ treatment, data = data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -10.439  -4.529  -1.179   2.271  13.061 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   20.839      1.429  14.581 3.72e-15 ***</span></span>
<span><span class="co">#&gt; treatment     -1.710      2.161  -0.792    0.435    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 6.064 on 30 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.02046,    Adjusted R-squared:  -0.01219 </span></span>
<span><span class="co">#&gt; F-statistic: 0.6265 on 1 and 30 DF,  p-value: 0.4348</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Response cyl :</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = cyl ~ treatment, data = data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -2.2857 -2.1111 -0.1111  1.7579  1.8889 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   6.1111     0.4274   14.30 6.21e-15 ***</span></span>
<span><span class="co">#&gt; treatment     0.1746     0.6461    0.27    0.789    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 1.813 on 30 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.002428,   Adjusted R-squared:  -0.03082 </span></span>
<span><span class="co">#&gt; F-statistic: 0.07302 on 1 and 30 DF,  p-value: 0.7888</span></span></code></pre></div>
<p>All of the coefficients in each regression are not significant.
Hence, we don’t have any concerns.</p>
<p>To be more rigorous, we should estimate all regressions
simultaneously using SUR if we suspect the error terms of the different
regression equations are correlated.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("systemfit")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/systemfit/" class="external-link">systemfit</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">equation1</span> <span class="op">&lt;-</span> <span class="va">mpg</span> <span class="op">~</span> <span class="va">treatment</span></span>
<span><span class="va">equation2</span> <span class="op">&lt;-</span> <span class="va">cyl</span> <span class="op">~</span> <span class="va">treatment</span></span>
<span></span>
<span><span class="va">system</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>characteristic <span class="op">=</span> <span class="va">equation1</span>, characteristic2 <span class="op">=</span> <span class="va">equation2</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemfit/man/systemfit.html" class="external-link">systemfit</a></span><span class="op">(</span><span class="va">system</span>, data <span class="op">=</span> <span class="va">data</span>, method <span class="op">=</span> <span class="st">"SUR"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; systemfit results </span></span>
<span><span class="co">#&gt; method: SUR </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         N DF     SSR detRCov   OLS-R2 McElroy-R2</span></span>
<span><span class="co">#&gt; system 64 60 1201.65 32.5288 0.019002   0.020257</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  N DF       SSR      MSE    RMSE       R2    Adj R2</span></span>
<span><span class="co">#&gt; characteristic  32 30 1103.0113 36.76705 6.06358 0.020457 -0.012194</span></span>
<span><span class="co">#&gt; characteristic2 32 30   98.6349  3.28783 1.81324 0.002428 -0.030824</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The covariance matrix of the residuals used for estimation</span></span>
<span><span class="co">#&gt;                 characteristic characteristic2</span></span>
<span><span class="co">#&gt; characteristic        36.76704        -9.39974</span></span>
<span><span class="co">#&gt; characteristic2       -9.39974         3.28783</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The covariance matrix of the residuals</span></span>
<span><span class="co">#&gt;                 characteristic characteristic2</span></span>
<span><span class="co">#&gt; characteristic        36.76704        -9.39974</span></span>
<span><span class="co">#&gt; characteristic2       -9.39974         3.28783</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The correlations of the residuals</span></span>
<span><span class="co">#&gt;                 characteristic characteristic2</span></span>
<span><span class="co">#&gt; characteristic        1.000000       -0.854932</span></span>
<span><span class="co">#&gt; characteristic2      -0.854932        1.000000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SUR estimates for 'characteristic' (equation 1)</span></span>
<span><span class="co">#&gt; Model Formula: mpg ~ treatment</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Estimate Std. Error  t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 20.83889    1.42920 14.58080 3.5527e-15 ***</span></span>
<span><span class="co">#&gt; treatment   -1.71032    2.16075 -0.79154    0.43484    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 6.063584 on 30 degrees of freedom</span></span>
<span><span class="co">#&gt; Number of observations: 32 Degrees of Freedom: 30 </span></span>
<span><span class="co">#&gt; SSR: 1103.011349 MSE: 36.767045 Root MSE: 6.063584 </span></span>
<span><span class="co">#&gt; Multiple R-Squared: 0.020457 Adjusted R-Squared: -0.012194 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SUR estimates for 'characteristic2' (equation 2)</span></span>
<span><span class="co">#&gt; Model Formula: cyl ~ treatment</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Estimate Std. Error  t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 6.111111   0.427384 14.29887 6.2172e-15 ***</span></span>
<span><span class="co">#&gt; treatment   0.174603   0.646144  0.27022    0.78884    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 1.813238 on 30 degrees of freedom</span></span>
<span><span class="co">#&gt; Number of observations: 32 Degrees of Freedom: 30 </span></span>
<span><span class="co">#&gt; SSR: 98.634921 MSE: 3.287831 Root MSE: 1.813238 </span></span>
<span><span class="co">#&gt; Multiple R-Squared: 0.002428 Adjusted R-Squared: -0.030824</span></span>
<span></span>
<span><span class="co"># or users could use the `balance_assessment` function to get both SUR and Hotelling</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance_assessment.html">balance_assessment</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"treatment"</span>, <span class="st">"mpg"</span>, <span class="st">"cyl"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">SUR</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; systemfit results </span></span>
<span><span class="co">#&gt; method: SUR </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         N DF     SSR detRCov   OLS-R2 McElroy-R2</span></span>
<span><span class="co">#&gt; system 64 60 1201.65 32.5288 0.019002   0.020257</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        N DF       SSR      MSE    RMSE       R2    Adj R2</span></span>
<span><span class="co">#&gt; mpgeq 32 30 1103.0113 36.76705 6.06358 0.020457 -0.012194</span></span>
<span><span class="co">#&gt; cyleq 32 30   98.6349  3.28783 1.81324 0.002428 -0.030824</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The covariance matrix of the residuals used for estimation</span></span>
<span><span class="co">#&gt;          mpgeq    cyleq</span></span>
<span><span class="co">#&gt; mpgeq 36.76704 -9.39974</span></span>
<span><span class="co">#&gt; cyleq -9.39974  3.28783</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The covariance matrix of the residuals</span></span>
<span><span class="co">#&gt;          mpgeq    cyleq</span></span>
<span><span class="co">#&gt; mpgeq 36.76704 -9.39974</span></span>
<span><span class="co">#&gt; cyleq -9.39974  3.28783</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The correlations of the residuals</span></span>
<span><span class="co">#&gt;           mpgeq     cyleq</span></span>
<span><span class="co">#&gt; mpgeq  1.000000 -0.854932</span></span>
<span><span class="co">#&gt; cyleq -0.854932  1.000000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SUR estimates for 'mpgeq' (equation 1)</span></span>
<span><span class="co">#&gt; Model Formula: mpg ~ treatment</span></span>
<span><span class="co">#&gt; &lt;environment: 0x00000152e2dc7c38&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Estimate Std. Error  t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 20.83889    1.42920 14.58080 3.5527e-15 ***</span></span>
<span><span class="co">#&gt; treatment   -1.71032    2.16075 -0.79154    0.43484    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 6.063584 on 30 degrees of freedom</span></span>
<span><span class="co">#&gt; Number of observations: 32 Degrees of Freedom: 30 </span></span>
<span><span class="co">#&gt; SSR: 1103.011349 MSE: 36.767045 Root MSE: 6.063584 </span></span>
<span><span class="co">#&gt; Multiple R-Squared: 0.020457 Adjusted R-Squared: -0.012194 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SUR estimates for 'cyleq' (equation 2)</span></span>
<span><span class="co">#&gt; Model Formula: cyl ~ treatment</span></span>
<span><span class="co">#&gt; &lt;environment: 0x00000152e2dcd798&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Estimate Std. Error  t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 6.111111   0.427384 14.29887 6.2172e-15 ***</span></span>
<span><span class="co">#&gt; treatment   0.174603   0.646144  0.27022    0.78884    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 1.813238 on 30 degrees of freedom</span></span>
<span><span class="co">#&gt; Number of observations: 32 Degrees of Freedom: 30 </span></span>
<span><span class="co">#&gt; SSR: 98.634921 MSE: 3.287831 Root MSE: 1.813238 </span></span>
<span><span class="co">#&gt; Multiple R-Squared: 0.002428 Adjusted R-Squared: -0.030824</span></span></code></pre></div>
<p>For <code>mpg</code> and <code>cyl</code>: The treatment effect is
not statistically significant, implying no evidence against random unit
assignment based on this characteristic.</p>
<p><strong>Hotelling’s T-squared test</strong></p>
<p>This is the multivariate counterpart of the T-test designed to test
the mean vector of two groups. It’s useful when you have multiple
pre-treatment characteristics and you want to test if their mean vectors
differ between the treated and control groups.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For Hotelling's T^2, you can use the `Hotelling` package.</span></span>
<span><span class="co"># install.packages("Hotelling")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jmcurran/Hotelling" class="external-link">Hotelling</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: corpcor</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'Hotelling'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     summarise</span></span>
<span></span>
<span><span class="va">treated_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">treatment</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mpg"</span>, <span class="st">"cyl"</span> <span class="op">)</span><span class="op">]</span></span>
<span><span class="va">control_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">treatment</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mpg"</span>, <span class="st">"cyl"</span> <span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">hotelling_test_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hotelling/man/hotelling.test.html" class="external-link">hotelling.test</a></span><span class="op">(</span><span class="va">treated_data</span>, <span class="va">control_data</span><span class="op">)</span></span>
<span><span class="va">hotelling_test_res</span></span>
<span><span class="co">#&gt; Test stat:  1.2406 </span></span>
<span><span class="co">#&gt; Numerator df:  2 </span></span>
<span><span class="co">#&gt; Denominator df:  29 </span></span>
<span><span class="co">#&gt; P-value:  0.5557</span></span>
<span></span>
<span><span class="co"># or users could use the `balance_assessment` function to get both SUR and Hotelling</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance_assessment.html">balance_assessment</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"treatment"</span>, <span class="st">"mpg"</span>, <span class="st">"cyl"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Hotelling</span><span class="op">)</span></span>
<span><span class="co">#&gt; Test stat:  1.2406 </span></span>
<span><span class="co">#&gt; Numerator df:  2 </span></span>
<span><span class="co">#&gt; Denominator df:  29 </span></span>
<span><span class="co">#&gt; P-value:  0.5557</span></span></code></pre></div>
<p><strong>Matching</strong></p>
<p>This is a more advanced technique, for example, modeling the
probability of being treated based on pre-treatment characteristics
using a logistic regression. After matching, you can test for balance in
the pre-treatment characteristics between the treated and control
groups.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For propensity score matching, use the `MatchIt` package.</span></span>
<span><span class="co"># install.packages("MatchIt")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kosukeimai.github.io/MatchIt/" class="external-link">MatchIt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">m.out</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html" class="external-link">matchit</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">~</span> <span class="va">mpg</span> <span class="op">+</span> <span class="va">cyl</span>,</span>
<span>          data <span class="op">=</span> <span class="va">data</span>,</span>
<span>          method <span class="op">=</span> <span class="st">"nearest"</span><span class="op">)</span></span>
<span><span class="va">matched_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/match.data.html" class="external-link">match.data</a></span><span class="op">(</span><span class="va">m.out</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># After matching, you can test for balance using t-tests or regressions.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">treatment</span>, data <span class="op">=</span> <span class="va">matched_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  mpg by treatment</span></span>
<span><span class="co">#&gt; t = -0.035239, df = 25.957, p-value = 0.9722</span></span>
<span><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span><span class="co">#&gt;  -4.238310  4.095453</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span><span class="co">#&gt;        19.05714        19.12857</span></span></code></pre></div>
<p>In conclusion, while visualizations provide an intuitive
understanding, statistical tests provide a more rigorous method for
assessing balance.</p>
</div>
</div>
<div class="section level2">
<h2 id="did-with-in-and-out-treatment-status">DID with in and out treatment status<a class="anchor" aria-label="anchor" href="#did-with-in-and-out-treatment-status"></a>
</h2>
<div class="section level3">
<h3 id="plots">Plots<a class="anchor" aria-label="anchor" href="#plots"></a>
</h3>
<div class="section level4">
<h4 id="balance-scatter">Balance Scatter<a class="anchor" aria-label="anchor" href="#balance-scatter"></a>
</h4>
<p>Since the <code>PanelMatch</code> package is no longer being updated
or developed, and its <code>balance_scatter</code> function does not
return a <code>ggplot</code> object, I have modified the code to return
a <code>ggplot</code> object in a more flexible manner.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">PanelMatch</span><span class="op">)</span></span>
<span><span class="co"># Maha 4-year lag, up to 5 matches</span></span>
<span><span class="va">PM.results.maha.4lag.5m</span> <span class="op">&lt;-</span> <span class="fu">PanelMatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PanelMatch/man/PanelMatch.html" class="external-link">PanelMatch</a></span><span class="op">(</span></span>
<span>   lag <span class="op">=</span> <span class="fl">4</span>,</span>
<span>   time.id <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>   unit.id <span class="op">=</span> <span class="st">"wbcode2"</span>,</span>
<span>   treatment <span class="op">=</span> <span class="st">"dem"</span>,</span>
<span>   refinement.method <span class="op">=</span> <span class="st">"mahalanobis"</span>,</span>
<span>   data <span class="op">=</span> <span class="fu">PanelMatch</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/PanelMatch/man/dem.html" class="external-link">dem</a></span>,</span>
<span>   match.missing <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   covs.formula <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">tradewb</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>   size.match <span class="op">=</span> <span class="fl">5</span>,</span>
<span>   qoi <span class="op">=</span> <span class="st">"att"</span>,</span>
<span>   outcome.var <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>   lead <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>   forbid.treatment.reversal <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>   use.diagonal.variance.matrix <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Maha 4-year lag, up to 10 matches</span></span>
<span><span class="va">PM.results.maha.4lag.10m</span> <span class="op">&lt;-</span> <span class="fu">PanelMatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PanelMatch/man/PanelMatch.html" class="external-link">PanelMatch</a></span><span class="op">(</span></span>
<span>   lag <span class="op">=</span> <span class="fl">4</span>,</span>
<span>   time.id <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>   unit.id <span class="op">=</span> <span class="st">"wbcode2"</span>,</span>
<span>   treatment <span class="op">=</span> <span class="st">"dem"</span>,</span>
<span>   refinement.method <span class="op">=</span> <span class="st">"mahalanobis"</span>,</span>
<span>   data <span class="op">=</span> <span class="fu">PanelMatch</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/PanelMatch/man/dem.html" class="external-link">dem</a></span>,</span>
<span>   match.missing <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   covs.formula <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">tradewb</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>   size.match <span class="op">=</span> <span class="fl">10</span>,</span>
<span>   qoi <span class="op">=</span> <span class="st">"att"</span>,</span>
<span>   outcome.var <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>   lead <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>   forbid.treatment.reversal <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>   use.diagonal.variance.matrix <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using the function</span></span>
<span><span class="fu"><a href="../reference/balance_scatter_custom.html">balance_scatter_custom</a></span><span class="op">(</span></span>
<span>   matched_set_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">PM.results.maha.4lag.5m</span><span class="op">$</span><span class="va">att</span>, <span class="va">PM.results.maha.4lag.10m</span><span class="op">$</span><span class="va">att</span><span class="op">)</span>,</span>
<span>   set.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Maha 4 Lag 5 Matches"</span>, <span class="st">"Maha 4 Lag 10 Matches"</span><span class="op">)</span>,</span>
<span>   data <span class="op">=</span> <span class="va">dem</span>,</span>
<span>   dot.size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>   covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"tradewb"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="did_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>When conducting research using matching methods for causal inference
with time-series cross-sectional data (as with the PanelMatch package),
it’s essential to evaluate the robustness of different matching or
weighting methods. This assessment allows researchers to gauge the
improvement in covariate balance resulting from the refinement of the
matched set. Testing the robustness ensures that the findings are not an
artifact of a specific matching method but are consistent across
different approaches. In essence, a robust result gives more confidence
in the causal relationships identified. Below is a quick guide on how to
proceed:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">PanelMatch</span><span class="op">)</span></span>
<span></span>
<span><span class="va">runPanelMatch</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">method</span>, <span class="va">lag</span>, <span class="va">size.match</span><span class="op">=</span><span class="cn">NULL</span>, <span class="va">qoi</span> <span class="op">=</span> <span class="st">"att"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># Default parameters for PanelMatch</span></span>
<span>    <span class="va">common.args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        lag <span class="op">=</span> <span class="va">lag</span>,</span>
<span>        time.id <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>        unit.id <span class="op">=</span> <span class="st">"wbcode2"</span>,</span>
<span>        treatment <span class="op">=</span> <span class="st">"dem"</span>,</span>
<span>        data <span class="op">=</span> <span class="va">dem</span>,</span>
<span>        covs.formula <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">tradewb</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        qoi <span class="op">=</span> <span class="va">qoi</span>,</span>
<span>        outcome.var <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>        lead <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>        forbid.treatment.reversal <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        size.match <span class="op">=</span> <span class="va">size.match</span>  <span class="co"># setting size.match here for all methods</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">method</span> <span class="op">==</span> <span class="st">"mahalanobis"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">common.args</span><span class="op">$</span><span class="va">refinement.method</span> <span class="op">&lt;-</span> <span class="st">"mahalanobis"</span></span>
<span>        <span class="va">common.args</span><span class="op">$</span><span class="va">match.missing</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>        <span class="va">common.args</span><span class="op">$</span><span class="va">use.diagonal.variance.matrix</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">method</span> <span class="op">==</span> <span class="st">"ps.match"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">common.args</span><span class="op">$</span><span class="va">refinement.method</span> <span class="op">&lt;-</span> <span class="st">"ps.match"</span></span>
<span>        <span class="va">common.args</span><span class="op">$</span><span class="va">match.missing</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>        <span class="va">common.args</span><span class="op">$</span><span class="va">listwise.delete</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">method</span> <span class="op">==</span> <span class="st">"ps.weight"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">common.args</span><span class="op">$</span><span class="va">refinement.method</span> <span class="op">&lt;-</span> <span class="st">"ps.weight"</span></span>
<span>        <span class="va">common.args</span><span class="op">$</span><span class="va">match.missing</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>        <span class="va">common.args</span><span class="op">$</span><span class="va">listwise.delete</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">PanelMatch</span>, <span class="va">common.args</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mahalanobis"</span>, <span class="st">"ps.match"</span>, <span class="st">"ps.weight"</span><span class="op">)</span></span>
<span><span class="va">lags</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">sizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>Run sequentially</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_pm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">method</span> <span class="kw">in</span> <span class="va">methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">lag</span> <span class="kw">in</span> <span class="va">lags</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">for</span><span class="op">(</span><span class="va">size</span> <span class="kw">in</span> <span class="va">sizes</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">method</span>, <span class="st">"."</span>, <span class="va">lag</span>, <span class="st">"lag."</span>, <span class="va">size</span>, <span class="st">"m"</span><span class="op">)</span></span>
<span>            <span class="va">res_pm</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">runPanelMatch</span><span class="op">(</span><span class="va">method</span>, <span class="va">lag</span>, <span class="va">size</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># for treatment reversal</span></span>
<span><span class="va">res_pm_rev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">method</span> <span class="kw">in</span> <span class="va">methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">lag</span> <span class="kw">in</span> <span class="va">lags</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">for</span><span class="op">(</span><span class="va">size</span> <span class="kw">in</span> <span class="va">sizes</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">method</span>, <span class="st">"."</span>, <span class="va">lag</span>, <span class="st">"lag."</span>, <span class="va">size</span>, <span class="st">"m"</span><span class="op">)</span></span>
<span>            <span class="va">res_pm_rev</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">runPanelMatch</span><span class="op">(</span><span class="va">method</span>, <span class="va">lag</span>, <span class="va">size</span>, qoi <span class="op">=</span> <span class="st">"art"</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Run parallel</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/foreach" class="external-link">foreach</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/doparallel" class="external-link">doParallel</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span>cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co"># Initialize an empty list to store results</span></span>
<span><span class="va">res_pm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Replace nested for-loops with foreach</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="va">methods</span>,</span>
<span>    .combine <span class="op">=</span> <span class="st">'c'</span>,</span>
<span>    .multicombine <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    .packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PanelMatch"</span>, <span class="st">"causalverse"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">%dopar%</a></span> <span class="op">{</span></span>
<span>    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">lag</span> <span class="kw">in</span> <span class="va">lags</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">size</span> <span class="kw">in</span> <span class="va">sizes</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">method</span>, <span class="st">"."</span>, <span class="va">lag</span>, <span class="st">"lag."</span>, <span class="va">size</span>, <span class="st">"m"</span><span class="op">)</span></span>
<span>        <span class="va">tmp</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">runPanelMatch</span><span class="op">(</span><span class="va">method</span>, <span class="va">lag</span>, <span class="va">size</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">tmp</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="co"># Collate results</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">res_pm</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Treatment reversal</span></span>
<span><span class="co"># Initialize an empty list to store results</span></span>
<span><span class="va">res_pm_rev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Replace nested for-loops with foreach</span></span>
<span><span class="va">results_rev</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="va">methods</span>,</span>
<span>    .combine <span class="op">=</span> <span class="st">'c'</span>,</span>
<span>    .multicombine <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    .packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PanelMatch"</span>, <span class="st">"causalverse"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">%dopar%</a></span> <span class="op">{</span></span>
<span>    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">lag</span> <span class="kw">in</span> <span class="va">lags</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">size</span> <span class="kw">in</span> <span class="va">sizes</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">method</span>, <span class="st">"."</span>, <span class="va">lag</span>, <span class="st">"lag."</span>, <span class="va">size</span>, <span class="st">"m"</span><span class="op">)</span></span>
<span>        <span class="va">tmp</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>          <span class="fu">runPanelMatch</span><span class="op">(</span><span class="va">method</span>, <span class="va">lag</span>, <span class="va">size</span>, qoi <span class="op">=</span> <span class="st">"art"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">tmp</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="co"># Collate results</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results_rev</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">res_pm_rev</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">results_rev</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">stopImplicitCluster</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now, you can access res_pm using res_pm[["mahalanobis.1lag.5m"]] etc.</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Updated plotting function</span></span>
<span><span class="va">create_balance_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">method</span>, <span class="va">lag</span>, <span class="va">sizes</span>, <span class="va">res_pm</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">matched_set_lists</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">sizes</span>, <span class="kw">function</span><span class="op">(</span><span class="va">size</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">res_pm</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">method</span>, <span class="st">"."</span>, <span class="va">lag</span>, <span class="st">"lag."</span>, <span class="va">size</span>, <span class="st">"m"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">att</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/balance_scatter_custom.html">balance_scatter_custom</a></span><span class="op">(</span></span>
<span>        matched_set_list <span class="op">=</span> <span class="va">matched_set_lists</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="st">"Possible Matches"</span>,</span>
<span>        set.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">sizes</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.8</span><span class="op">)</span>,</span>
<span>        </span>
<span>        <span class="co"># for compiled plot, you don't need x,y, or main labs</span></span>
<span>        x.axis.label <span class="op">=</span> <span class="st">""</span>,</span>
<span>        y.axis.label <span class="op">=</span> <span class="st">""</span>,</span>
<span>        main <span class="op">=</span> <span class="st">""</span>,</span>
<span>        data <span class="op">=</span> <span class="va">data</span>,</span>
<span>        dot.size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        <span class="co"># show.legend = F,</span></span>
<span>        them_use <span class="op">=</span> <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/ama_theme.html">ama_theme</a></span><span class="op">(</span></span>
<span>          base_size <span class="op">=</span> <span class="fl">32</span>,</span>
<span>          legend_title_size <span class="op">=</span> <span class="fl">12</span>,</span>
<span>          legend_text_size <span class="op">=</span> <span class="fl">12</span></span>
<span>        <span class="op">)</span>, </span>
<span>        covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"tradewb"</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">method</span> <span class="kw">in</span> <span class="va">methods</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">lag</span> <span class="kw">in</span> <span class="va">lags</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">plots</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">method</span>, <span class="st">"."</span>, <span class="va">lag</span>, <span class="st">"lag"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>      <span class="fu">create_balance_plot</span><span class="op">(</span><span class="va">method</span>, <span class="va">lag</span>, <span class="va">sizes</span>, <span class="va">res_pm</span>, <span class="va">dem</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># # Arranging plots in a 3x2 grid</span></span>
<span><span class="co"># grid.arrange(plots[["mahalanobis.1lag"]],</span></span>
<span><span class="co">#              plots[["mahalanobis.4lag"]],</span></span>
<span><span class="co">#              plots[["ps.match.1lag"]],</span></span>
<span><span class="co">#              plots[["ps.match.4lag"]],</span></span>
<span><span class="co">#              plots[["ps.weight.1lag"]],</span></span>
<span><span class="co">#              plots[["ps.weight.4lag"]],</span></span>
<span><span class="co">#              ncol=2, nrow=3)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># Standardized Mean Difference of Covariates</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create column and row labels using textGrob</span></span>
<span><span class="va">col_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1-year Lag"</span>, <span class="st">"4-year Lag"</span><span class="op">)</span></span>
<span><span class="va">row_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Maha Matching"</span>, <span class="st">"PS Matching"</span>, <span class="st">"PS Weigthing"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">major.axes.fontsize</span> <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="va">minor.axes.fontsize</span> <span class="op">=</span> <span class="fl">16</span></span></code></pre></div>
<p>To export</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"export"</span>, <span class="st">"balance_scatter.png"</span><span class="op">)</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">1200</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Create a list-of-lists, where each inner list represents a row</span></span>
<span><span class="va">grid_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.null.html" class="external-link">nullGrob</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">col_labels</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">col_labels</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span></span>
<span>    <span class="va">row_labels</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span>,</span>
<span>    rot <span class="op">=</span> <span class="fl">90</span></span>
<span>  <span class="op">)</span>, <span class="va">plots</span><span class="op">[[</span><span class="st">"mahalanobis.1lag"</span><span class="op">]</span><span class="op">]</span>, <span class="va">plots</span><span class="op">[[</span><span class="st">"mahalanobis.4lag"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span></span>
<span>    <span class="va">row_labels</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span>,</span>
<span>    rot <span class="op">=</span> <span class="fl">90</span></span>
<span>  <span class="op">)</span>, <span class="va">plots</span><span class="op">[[</span><span class="st">"ps.match.1lag"</span><span class="op">]</span><span class="op">]</span>, <span class="va">plots</span><span class="op">[[</span><span class="st">"ps.match.4lag"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span></span>
<span>    <span class="va">row_labels</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>    gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span>,</span>
<span>    rot <span class="op">=</span> <span class="fl">90</span></span>
<span>  <span class="op">)</span>, <span class="va">plots</span><span class="op">[[</span><span class="st">"ps.weight.1lag"</span><span class="op">]</span><span class="op">]</span>, <span class="va">plots</span><span class="op">[[</span><span class="st">"ps.weight.4lag"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># "Flatten" the list-of-lists into a single list of grobs</span></span>
<span><span class="va">grobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="va">grid_list</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span></span>
<span>  grobs <span class="op">=</span> <span class="va">grobs</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.42</span>, <span class="fl">0.42</span><span class="op">)</span>,</span>
<span>  heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.28</span>, <span class="fl">0.28</span>, <span class="fl">0.28</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">grid.text</a></span><span class="op">(</span></span>
<span>  <span class="st">"Before Refinement"</span>,</span>
<span>  x <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  y <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>  gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">major.axes.fontsize</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">grid.text</a></span><span class="op">(</span></span>
<span>  <span class="st">"After Refinement"</span>,</span>
<span>  x <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>  y <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  rot <span class="op">=</span> <span class="fl">90</span>,</span>
<span>  gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">major.axes.fontsize</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html" class="external-link">include_graphics</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"export"</span>, <span class="st">"balance_scatter.png"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>I do not include it in this vignette due to display issues, but the
code can be easily replicated.</p>
</div>
<div class="section level4">
<h4 id="balance-trends-over-pre-treatment-periods">Balance Trends over Pre-treatment Periods<a class="anchor" aria-label="anchor" href="#balance-trends-over-pre-treatment-periods"></a>
</h4>
<p>In the original <code>PanelMatch</code> package, the function
<code>get_covariate_balance</code> does not return a <code>ggplot</code>
object. Therefore, it is necessary to construct our own visualization.
However, one can utilize the output dataset from
<code>get_covariate_balance</code> for this purpose.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PM.results.ps.weight</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/PanelMatch/man/PanelMatch.html" class="external-link">PanelMatch</a></span><span class="op">(</span></span>
<span>        lag                       <span class="op">=</span> <span class="fl">4</span>,</span>
<span>        time.id                   <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>        unit.id                   <span class="op">=</span> <span class="st">"wbcode2"</span>,</span>
<span>        treatment                 <span class="op">=</span> <span class="st">"dem"</span>,</span>
<span>        refinement.method         <span class="op">=</span> <span class="st">"ps.weight"</span>,</span>
<span>        data                      <span class="op">=</span> <span class="va">dem</span>,</span>
<span>        match.missing             <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        listwise.delete           <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        covs.formula              <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">tradewb</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        size.match                <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        qoi                       <span class="op">=</span> <span class="st">"att"</span>,</span>
<span>        outcome.var               <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>        lead                      <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>        forbid.treatment.reversal <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PanelMatch/man/get_covariate_balance.html" class="external-link">get_covariate_balance</a></span><span class="op">(</span></span>
<span>    <span class="va">PM.results.ps.weight</span><span class="op">$</span><span class="va">att</span>,</span>
<span>    data <span class="op">=</span> <span class="va">dem</span>,</span>
<span>    covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tradewb"</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_covariate_balance_pretrend.html">plot_covariate_balance_pretrend</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<p><img src="did_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>We must also examine multiple matching and refining methods to ensure
that we have robust evidence for covariate balance over the
pre-treatment time period.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 1: Define configurations</span></span>
<span><span class="va">configurations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>refinement.method <span class="op">=</span> <span class="st">"none"</span>, qoi <span class="op">=</span> <span class="st">"att"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>refinement.method <span class="op">=</span> <span class="st">"none"</span>, qoi <span class="op">=</span> <span class="st">"art"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>refinement.method <span class="op">=</span> <span class="st">"mahalanobis"</span>, qoi <span class="op">=</span> <span class="st">"att"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>refinement.method <span class="op">=</span> <span class="st">"mahalanobis"</span>, qoi <span class="op">=</span> <span class="st">"art"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>refinement.method <span class="op">=</span> <span class="st">"ps.match"</span>, qoi <span class="op">=</span> <span class="st">"att"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>refinement.method <span class="op">=</span> <span class="st">"ps.match"</span>, qoi <span class="op">=</span> <span class="st">"art"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>refinement.method <span class="op">=</span> <span class="st">"ps.weight"</span>, qoi <span class="op">=</span> <span class="st">"att"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>refinement.method <span class="op">=</span> <span class="st">"ps.weight"</span>, qoi <span class="op">=</span> <span class="st">"art"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Use lapply or loop to generate results</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">configurations</span>, <span class="kw">function</span><span class="op">(</span><span class="va">config</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/PanelMatch/man/PanelMatch.html" class="external-link">PanelMatch</a></span><span class="op">(</span></span>
<span>        lag                       <span class="op">=</span> <span class="fl">4</span>,</span>
<span>        time.id                   <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>        unit.id                   <span class="op">=</span> <span class="st">"wbcode2"</span>,</span>
<span>        treatment                 <span class="op">=</span> <span class="st">"dem"</span>,</span>
<span>        data                      <span class="op">=</span> <span class="va">dem</span>,</span>
<span>        match.missing             <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        listwise.delete           <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        size.match                <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        outcome.var               <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>        lead                      <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>        forbid.treatment.reversal <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        refinement.method         <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">refinement.method</span>,</span>
<span>        covs.formula              <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">tradewb</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        qoi                       <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">qoi</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Step 3: Get covariate balance and plot</span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">result</span>, <span class="va">config</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PanelMatch/man/get_covariate_balance.html" class="external-link">get_covariate_balance</a></span><span class="op">(</span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="va">config</span><span class="op">$</span><span class="va">qoi</span> <span class="op">==</span> <span class="st">"att"</span><span class="op">)</span> <span class="va">result</span><span class="op">$</span><span class="va">att</span> <span class="kw">else</span> <span class="va">result</span><span class="op">$</span><span class="va">art</span>, </span>
<span>        data <span class="op">=</span> <span class="va">dem</span>, </span>
<span>        covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tradewb"</span>, <span class="st">"y"</span><span class="op">)</span>, </span>
<span>        plot <span class="op">=</span> <span class="cn">F</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_covariate_balance_pretrend.html">plot_covariate_balance_pretrend</a></span><span class="op">(</span><span class="va">df</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="op">}</span>, <span class="va">results</span>, <span class="va">configurations</span>, SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set names for plots</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">plots</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">configurations</span>, <span class="kw">function</span><span class="op">(</span><span class="va">config</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">config</span><span class="op">$</span><span class="va">qoi</span>, <span class="va">config</span><span class="op">$</span><span class="va">refinement.method</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To view plots</span></span>
<span><span class="co"># lapply(plots, print)</span></span>
<span></span>
<span><span class="co"># grid.arrange(</span></span>
<span><span class="co">#   plots$att.none,</span></span>
<span><span class="co">#   plots$att.mahalanobis,</span></span>
<span><span class="co">#   plots$att.ps.match,</span></span>
<span><span class="co">#   plots$att.ps.weight,</span></span>
<span><span class="co">#   plots$art.none,</span></span>
<span><span class="co">#   plots$art.mahalanobis,</span></span>
<span><span class="co">#   plots$art.ps.match,</span></span>
<span><span class="co">#   plots$art.ps.weight,</span></span>
<span><span class="co">#   ncol = 4,</span></span>
<span><span class="co">#   nrow = 2</span></span>
<span><span class="co"># )</span></span>
<span></span>
<span></span>
<span><span class="co"># Equivalently</span></span>
<span><span class="co"># grid.arrange(grobs = c(plots[paste0("att.", c("none", "mahalanobis", "ps.match", "ps.weight"))], plots[paste0("art.", c("none", "mahalanobis", "ps.match", "ps.weight"))]),  ncol = 4)</span></span></code></pre></div>
<p>For a fancier plot</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Column and row labels</span></span>
<span><span class="va">col_labels</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"None"</span>,</span>
<span>    <span class="st">"Mahalanobis"</span>,</span>
<span>    <span class="st">"Propensity Score Matching"</span>,</span>
<span>    <span class="st">"Propensity Score Weighting"</span><span class="op">)</span></span>
<span><span class="va">row_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ATT"</span>, <span class="st">"ART"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify your desired fontsize for labels</span></span>
<span><span class="va">minor.axes.fontsize</span> <span class="op">&lt;-</span> <span class="fl">16</span></span>
<span><span class="va">major.axes.fontsize</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"export"</span>, <span class="st">"var_balance_pretreat.png"</span><span class="op">)</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">1200</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a list-of-lists, where each inner list represents a row</span></span>
<span><span class="va">grid_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.null.html" class="external-link">nullGrob</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">col_labels</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">col_labels</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">col_labels</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">col_labels</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">row_labels</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,</span>
<span>    <span class="va">plots</span><span class="op">$</span><span class="va">att.none</span>,</span>
<span>    <span class="va">plots</span><span class="op">$</span><span class="va">att.mahalanobis</span>,</span>
<span>    <span class="va">plots</span><span class="op">$</span><span class="va">att.ps.match</span>,</span>
<span>    <span class="va">plots</span><span class="op">$</span><span class="va">att.ps.weight</span></span>
<span>  <span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">row_labels</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,</span>
<span>    <span class="va">plots</span><span class="op">$</span><span class="va">art.none</span>,</span>
<span>    <span class="va">plots</span><span class="op">$</span><span class="va">art.mahalanobis</span>,</span>
<span>    <span class="va">plots</span><span class="op">$</span><span class="va">art.ps.match</span>,</span>
<span>    <span class="va">plots</span><span class="op">$</span><span class="va">art.ps.weight</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># "Flatten" the list-of-lists into a single list of grobs</span></span>
<span><span class="va">grobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="va">grid_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Arrange your plots with text labels</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span></span>
<span>  grobs   <span class="op">=</span> <span class="va">grobs</span>,</span>
<span>  ncol    <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  nrow    <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  widths  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.225</span>, <span class="fl">0.225</span>, <span class="fl">0.225</span>, <span class="fl">0.225</span><span class="op">)</span>,</span>
<span>  heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.45</span>, <span class="fl">0.45</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add main x and y axis titles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">grid.text</a></span><span class="op">(</span></span>
<span>  <span class="st">"Refinement Methods"</span>,</span>
<span>  x  <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  y  <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">major.axes.fontsize</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">grid.text</a></span><span class="op">(</span></span>
<span>  <span class="st">"Quantities of Interest"</span>,</span>
<span>  x   <span class="op">=</span> <span class="fl">0.02</span>,</span>
<span>  y   <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  rot <span class="op">=</span> <span class="fl">90</span>,</span>
<span>  gp  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">major.axes.fontsize</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="estimation">Estimation<a class="anchor" aria-label="anchor" href="#estimation"></a>
</h3>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sequential</span></span>
<span><span class="co"># Step 1: Apply PanelEstimate function</span></span>
<span></span>
<span><span class="co"># Initialize an empty list to store results</span></span>
<span><span class="va">res_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">res_pm</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Iterate over each element in res_pm</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">res_pm</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">res_est</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PanelMatch/man/PanelEstimate.html" class="external-link">PanelEstimate</a></span><span class="op">(</span></span>
<span>    <span class="va">res_pm</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    data <span class="op">=</span> <span class="va">dem</span>,</span>
<span>    se.method <span class="op">=</span> <span class="st">"bootstrap"</span>,</span>
<span>    number.iterations <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    confidence.level <span class="op">=</span> <span class="fl">.95</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># Transfer the name of the current element to the res_est list</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_est</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_pm</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Step 2: Apply plot_PanelEstimate function</span></span>
<span></span>
<span><span class="co"># Initialize an empty list to store plot results</span></span>
<span><span class="va">res_est_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">res_est</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Iterate over each element in res_est</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">res_est</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">res_est_plot</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>        <span class="fu"><a href="../reference/plot_PanelEstimate.html">plot_PanelEstimate</a></span><span class="op">(</span><span class="va">res_est</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                           main <span class="op">=</span> <span class="st">""</span>,</span>
<span>                           theme_use <span class="op">=</span> <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/ama_theme.html">ama_theme</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co"># Transfer the name of the current element to the res_est_plot list</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_est_plot</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_est</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># check results</span></span>
<span><span class="co"># res_est_plot$mahalanobis.1lag.5m</span></span>
<span></span>
<span></span>
<span><span class="co"># Step 1: Apply PanelEstimate function for res_pm_rev</span></span>
<span></span>
<span><span class="co"># Initialize an empty list to store results</span></span>
<span><span class="va">res_est_rev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">res_pm_rev</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Iterate over each element in res_pm_rev</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">res_pm_rev</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">res_est_rev</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PanelMatch/man/PanelEstimate.html" class="external-link">PanelEstimate</a></span><span class="op">(</span></span>
<span>    <span class="va">res_pm_rev</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    data <span class="op">=</span> <span class="va">dem</span>,</span>
<span>    se.method <span class="op">=</span> <span class="st">"bootstrap"</span>,</span>
<span>    number.iterations <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    confidence.level <span class="op">=</span> <span class="fl">.95</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># Transfer the name of the current element to the res_est_rev list</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_est_rev</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_pm_rev</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Step 2: Apply plot_PanelEstimate function for res_est_rev</span></span>
<span></span>
<span><span class="co"># Initialize an empty list to store plot results</span></span>
<span><span class="va">res_est_plot_rev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">res_est_rev</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Iterate over each element in res_est_rev</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">res_est_rev</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">res_est_plot_rev</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>        <span class="fu"><a href="../reference/plot_PanelEstimate.html">plot_PanelEstimate</a></span><span class="op">(</span><span class="va">res_est_rev</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                           main <span class="op">=</span> <span class="st">""</span>,</span>
<span>                           theme_use <span class="op">=</span> <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/ama_theme.html">ama_theme</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Transfer the name of the current element to the res_est_plot_rev list</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_est_plot_rev</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_est_rev</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># parallel</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/doparallel" class="external-link">doParallel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/foreach" class="external-link">foreach</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Detect the number of cores to use for parallel processing</span></span>
<span><span class="va">num_cores</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span></span>
<span><span class="co"># Register the parallel backend</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="va">num_cores</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 1: Apply PanelEstimate function in parallel</span></span>
<span><span class="va">res_est</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">res_pm</span><span class="op">)</span>, .packages <span class="op">=</span> <span class="st">"PanelMatch"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">%dopar%</a></span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/PanelMatch/man/PanelEstimate.html" class="external-link">PanelEstimate</a></span><span class="op">(</span></span>
<span>            <span class="va">res_pm</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>            data <span class="op">=</span> <span class="va">dem</span>,</span>
<span>            se.method <span class="op">=</span> <span class="st">"bootstrap"</span>,</span>
<span>            number.iterations <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>            confidence.level <span class="op">=</span> <span class="fl">.95</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span><span class="co"># Transfer names from res_pm to res_est</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_est</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_pm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Apply plot_PanelEstimate function in parallel</span></span>
<span><span class="va">res_est_plot</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span></span>
<span>        i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">res_est</span><span class="op">)</span>,</span>
<span>        .packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PanelMatch"</span>, <span class="st">"causalverse"</span>, <span class="st">"ggplot2"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">%dopar%</a></span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="../reference/plot_PanelEstimate.html">plot_PanelEstimate</a></span><span class="op">(</span><span class="va">res_est</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                           main <span class="op">=</span> <span class="st">""</span>,</span>
<span>                           theme_use <span class="op">=</span> <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/ama_theme.html">ama_theme</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span><span class="co"># Transfer names from res_est to res_est_plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_est_plot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_est</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># Step 1: Apply PanelEstimate function for res_pm_rev in parallel</span></span>
<span><span class="va">res_est_rev</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">res_pm_rev</span><span class="op">)</span>, .packages <span class="op">=</span> <span class="st">"PanelMatch"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">%dopar%</a></span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/PanelMatch/man/PanelEstimate.html" class="external-link">PanelEstimate</a></span><span class="op">(</span></span>
<span>            <span class="va">res_pm_rev</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>            data <span class="op">=</span> <span class="va">dem</span>,</span>
<span>            se.method <span class="op">=</span> <span class="st">"bootstrap"</span>,</span>
<span>            number.iterations <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>            confidence.level <span class="op">=</span> <span class="fl">.95</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span><span class="co"># Transfer names from res_pm_rev to res_est_rev</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_est_rev</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_pm_rev</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Apply plot_PanelEstimate function for res_est_rev in parallel</span></span>
<span><span class="va">res_est_plot_rev</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span></span>
<span>        i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">res_est_rev</span><span class="op">)</span>,</span>
<span>        .packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PanelMatch"</span>, <span class="st">"causalverse"</span>, <span class="st">"ggplot2"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">%dopar%</a></span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="../reference/plot_PanelEstimate.html">plot_PanelEstimate</a></span><span class="op">(</span><span class="va">res_est_rev</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                           main <span class="op">=</span> <span class="st">""</span>,</span>
<span>                           theme_use <span class="op">=</span> <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/ama_theme.html">ama_theme</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span><span class="co"># Transfer names from res_est_rev to res_est_plot_rev</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_est_plot_rev</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_est_rev</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Stop the cluster</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Column and row labels</span></span>
<span><span class="va">col_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mahalanobis 5m"</span>, </span>
<span>                <span class="st">"Mahalanobis 10m"</span>, </span>
<span>                <span class="st">"PS Matching 5m"</span>, </span>
<span>                <span class="st">"PS Matching 10m"</span>, </span>
<span>                <span class="st">"PS Weighting 5m"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">row_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ATT"</span>, <span class="st">"ART"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify your desired fontsize for labels</span></span>
<span><span class="va">minor.axes.fontsize</span> <span class="op">&lt;-</span> <span class="fl">16</span></span>
<span><span class="va">major.axes.fontsize</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span></span>
<span><span class="co"># Create a list-of-lists, where each inner list represents a row</span></span>
<span><span class="va">grid_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.null.html" class="external-link">nullGrob</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">col_labels</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">col_labels</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">col_labels</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">col_labels</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">col_labels</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">row_labels</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,</span>
<span>    <span class="va">res_est_plot</span><span class="op">$</span><span class="va">mahalanobis.1lag.5m</span>,</span>
<span>    <span class="va">res_est_plot</span><span class="op">$</span><span class="va">mahalanobis.1lag.10m</span>,</span>
<span>    <span class="va">res_est_plot</span><span class="op">$</span><span class="va">ps.match.1lag.5m</span>,</span>
<span>    <span class="va">res_est_plot</span><span class="op">$</span><span class="va">ps.match.1lag.10m</span>,</span>
<span>    <span class="va">res_est_plot</span><span class="op">$</span><span class="va">ps.weight.1lag.5m</span></span>
<span>  <span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">row_labels</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">minor.axes.fontsize</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,</span>
<span>    <span class="va">res_est_plot_rev</span><span class="op">$</span><span class="va">mahalanobis.1lag.5m</span>,</span>
<span>    <span class="va">res_est_plot_rev</span><span class="op">$</span><span class="va">mahalanobis.1lag.10m</span>,</span>
<span>    <span class="va">res_est_plot_rev</span><span class="op">$</span><span class="va">ps.match.1lag.5m</span>,</span>
<span>    <span class="va">res_est_plot_rev</span><span class="op">$</span><span class="va">ps.match.1lag.10m</span>,</span>
<span>    <span class="va">res_est_plot_rev</span><span class="op">$</span><span class="va">ps.weight.1lag.5m</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># "Flatten" the list-of-lists into a single list of grobs</span></span>
<span><span class="va">grobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="va">grid_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Arrange your plots with text labels</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span></span>
<span>  grobs   <span class="op">=</span> <span class="va">grobs</span>,</span>
<span>  ncol    <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  nrow    <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  widths  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.18</span>, <span class="fl">0.18</span>, <span class="fl">0.18</span>, <span class="fl">0.18</span>, <span class="fl">0.18</span><span class="op">)</span>,</span>
<span>  heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.45</span>, <span class="fl">0.45</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add main x and y axis titles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">grid.text</a></span><span class="op">(</span></span>
<span>  <span class="st">"Methods"</span>,</span>
<span>  x  <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  y  <span class="op">=</span> <span class="fl">0.02</span>,</span>
<span>  gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">major.axes.fontsize</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">grid.text</a></span><span class="op">(</span></span>
<span>  <span class="st">""</span>,</span>
<span>  x   <span class="op">=</span> <span class="fl">0.02</span>,</span>
<span>  y   <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  rot <span class="op">=</span> <span class="fl">90</span>,</span>
<span>  gp  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="va">major.axes.fontsize</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="staggered-did">Staggered DID<a class="anchor" aria-label="anchor" href="#staggered-did"></a>
</h2>
<p>Staggered DiD (Difference-in-Differences) designs are becoming
increasingly common in empirical research. These designs arise when
different units (like firms, regions, or countries) receive treatments
at different time periods. This presents a unique challenge, as standard
DiD methods often do not apply seamlessly to such setups.</p>
<p>For data analyses involving staggered DiD designs, it’s pivotal to
properly align treatment and control groups. Enter the
<strong><code>stack_data</code></strong> function.</p>
<p>What does staggered DiD mean? It’s when different groups receive
treatment at varied times. Simply analyzing this using standard DiD
methods can lead to wrong results because the control (comparison)
groups become intertwined and misaligned. This is often referred to as
the forbidden regression due to these muddled control groups.</p>
<p>The brilliance of the <strong><code>stack_data</code></strong>
function is how it streamlines the data:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Creating Cohorts</strong>: The function first categorizes
or groups the data based on when a treatment was applied. Each of these
groups is called a cohort.</p></li>
<li><p><strong>Defining Control Groups</strong>: For every treatment
cohort (those treated at the same time), control units are meticulously
chosen. These are units either never treated or those yet to receive
treatment. The distinction matters and ensures precision in
comparisons.</p></li>
<li><p><strong>Stacking with Reference</strong>: Now, while stacking
these cohorts, the function treats the period of treatment for each
cohort as their respective reference or benchmark. So, even if one group
was treated in 2019 and another in 2022, during stacking, the 2019
treated period aligns with the 2022 one. This alignment ensures a
consistent reference period across cohorts.</p></li>
<li><p><strong>Adding Markers</strong>: To make future analysis
smoother, the function adds relative period dummy variables. These act
like bookmarks, indicating periods before and after the treatment for
each stacked cohort.</p></li>
</ol>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>treated_period_var</code></strong>: The column name
indicating when a given unit was treated.</p></li>
<li><p><strong><code>time_var</code></strong>: The column indicating
time periods.</p></li>
<li><p><strong><code>pre_window</code></strong>: Number of periods
before the treatment to consider.</p></li>
<li><p><strong><code>post_window</code></strong>: Number of periods
after the treatment to consider.</p></li>
<li><p><strong><code>data</code></strong>: The dataset to be
processed.</p></li>
</ul>
<p>The function assumes the existence of a control group, represented by
the value <strong><code>10000</code></strong> in the
<strong><code>treated_period_var</code></strong> column.</p>
<p><strong>Example Usage</strong></p>
<p>Now, let’s see the function in action using the
<strong><code>base_stagg</code></strong> dataset from the
<strong><code>did</code></strong> package:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assuming the function is loaded from your package:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bcallaway11.github.io/did/" class="external-link">did</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/" class="external-link">fixest</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">base_stagg</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The stack_data function now has a control_type argument. This allows users to specify</span></span>
<span><span class="co"># the type of control group they want to include in their study: "both", "never-treated", or "not-yet-treated".</span></span>
<span></span>
<span><span class="co"># It's crucial to select an appropriate control group for your analysis. Different control groups can</span></span>
<span><span class="co"># lead to different interpretations. For instance:</span></span>
<span><span class="co"># - "never-treated" refers to units that never receive the treatment.</span></span>
<span><span class="co"># - "not-yet-treated" refers to units that will eventually be treated but haven't been as of a given period.</span></span>
<span><span class="co"># - "both" uses a combination of the two above.</span></span>
<span></span>
<span><span class="co"># Let's see how the function behaves for each control type:</span></span>
<span></span>
<span><span class="co"># 1. Using both never-treated and not-yet-treated as controls:</span></span>
<span><span class="va">stacked_data_both</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stack_data.html">stack_data</a></span><span class="op">(</span><span class="st">"year_treated"</span>, <span class="st">"year"</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="va">base_stagg</span>, control_type <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">feols_result_both</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html" class="external-link">feols</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">"y ~ "</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"`rel_period_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span><span class="op">:</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="st">"`"</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span>,</span>
<span>  <span class="st">" | id ^ df + year ^ df"</span></span>
<span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">stacked_data_both</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Using only never-treated units as controls:</span></span>
<span><span class="va">stacked_data_never</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stack_data.html">stack_data</a></span><span class="op">(</span><span class="st">"year_treated"</span>, <span class="st">"year"</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="va">base_stagg</span>, control_type <span class="op">=</span> <span class="st">"never-treated"</span><span class="op">)</span></span>
<span><span class="va">feols_result_never</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html" class="external-link">feols</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">"y ~ "</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"`rel_period_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span><span class="op">:</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="st">"`"</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span>,</span>
<span>  <span class="st">" | id ^ df + year ^ df"</span></span>
<span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">stacked_data_never</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Using only not-yet-treated units as controls:</span></span>
<span><span class="va">stacked_data_notyet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stack_data.html">stack_data</a></span><span class="op">(</span><span class="st">"year_treated"</span>, <span class="st">"year"</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="va">base_stagg</span>, control_type <span class="op">=</span> <span class="st">"not-yet-treated"</span><span class="op">)</span></span>
<span><span class="va">feols_result_notyet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html" class="external-link">feols</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">"y ~ "</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"`rel_period_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span><span class="op">:</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="st">"`"</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span>,</span>
<span>  <span class="st">" | id ^ df + year ^ df"</span></span>
<span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">stacked_data_notyet</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/etable.html" class="external-link">etable</a></span><span class="op">(</span><span class="va">feols_result_both</span>,</span>
<span>       <span class="va">feols_result_never</span>,</span>
<span>       <span class="va">feols_result_notyet</span>,</span>
<span>       vcov <span class="op">=</span> <span class="op">~</span> <span class="va">id</span> <span class="op">^</span> <span class="va">df</span> <span class="op">+</span> <span class="va">year</span> <span class="op">^</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   feols_result_both  feols_result_never feols_result_no..</span></span>
<span><span class="co">#&gt; Dependent Var.:                   y                   y                 y</span></span>
<span><span class="co">#&gt;                                                                          </span></span>
<span><span class="co">#&gt; `rel_period_-3`     0.3699 (0.7082)     0.3820 (0.6960)    0.2173 (1.164)</span></span>
<span><span class="co">#&gt; `rel_period_-2`     0.5794 (0.6933)     0.5918 (0.6779)    0.3961 (1.060)</span></span>
<span><span class="co">#&gt; rel_period_0     -5.017*** (0.8825)  -5.042*** (0.8763) -2.757** (0.9691)</span></span>
<span><span class="co">#&gt; rel_period_1     -3.226*** (0.7546)  -3.246*** (0.7291)   -1.988. (1.161)</span></span>
<span><span class="co">#&gt; rel_period_2      -2.463** (0.7358)   -2.451** (0.7128)    -1.436 (1.113)</span></span>
<span><span class="co">#&gt; rel_period_3       -0.5316 (0.8103)    -0.4680 (0.8137)    0.2322 (1.030)</span></span>
<span><span class="co">#&gt; Fixed-Effects:   ------------------  ------------------ -----------------</span></span>
<span><span class="co">#&gt; id-df                           Yes                 Yes               Yes</span></span>
<span><span class="co">#&gt; year-df                         Yes                 Yes               Yes</span></span>
<span><span class="co">#&gt; _______________  __________________  __________________ _________________</span></span>
<span><span class="co">#&gt; S.E.: Clustered by: id-df &amp; year-df by: id-df &amp; year-df by: id-df &amp; year.</span></span>
<span><span class="co">#&gt; Observations                  3,425               2,970               725</span></span>
<span><span class="co">#&gt; R2                          0.32684             0.33290           0.50317</span></span>
<span><span class="co">#&gt; Within R2                   0.07325             0.08228           0.06261</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span></span>
<span><span class="co"># Sample regression summary using the output for the "both" case as an example:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">feols_result_both</span>, agg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"att"</span> <span class="op">=</span> <span class="st">"rel_period_[012345]"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 3,425 </span></span>
<span><span class="co">#&gt; Fixed-effects: id^df: 570,  year^df: 54</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (id^df) </span></span>
<span><span class="co">#&gt;                  Estimate Std. Error   t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; `rel_period_-3`  0.369901   0.568682  0.650454 5.1566e-01    </span></span>
<span><span class="co">#&gt; `rel_period_-2`  0.579418   0.491868  1.177996 2.3929e-01    </span></span>
<span><span class="co">#&gt; att             -3.046195   0.475912 -6.400752 3.2351e-10 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 1.94202     Adj. R2: 0.175642</span></span>
<span><span class="co">#&gt;                 Within R2: 0.073253</span></span>
<span></span>
<span><span class="co"># Coefficient plot</span></span>
<span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/coefplot.html" class="external-link">coefplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">feols_result_both</span>,</span>
<span>              <span class="va">feols_result_never</span>,</span>
<span>              <span class="va">feols_result_notyet</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Both"</span>, <span class="st">"Never"</span>, <span class="st">"Notyet"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="did_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<p>Differences in the estimates across the three models arise from the
variation in control groups:</p>
<ol style="list-style-type: decimal">
<li>
<p><strong>Both Never-Treated and Not-Yet-Treated</strong>:</p>
<ul>
<li>Uses both control groups. The similarity with the “Never-Treated”
estimates suggests consistent pre-treatment trends between these control
groups and the treated units.</li>
</ul>
</li>
<li>
<p><strong>Never-Treated</strong>:</p>
<ul>
<li>Units never receiving treatment. Given the similarity with the
combined group, it implies this group provides a reliable
counterfactual.</li>
</ul>
</li>
<li>
<p><strong>Not-Yet-Treated</strong>:</p>
<ul>
<li>Units eventually getting treatment. The substantially lower
estimates suggest differential pre-treatment trends compared to treated
units, potentially biasing treatment effects.</li>
</ul>
</li>
</ol>
<p>The observed differences emphasize the importance of the parallel
trends assumption in difference-in-differences analyses. Violations can
bias treatment effect estimates. The choice of control group(s) should
be grounded in understanding their appropriateness as counterfactuals,
and additional analyses (like visualizing trends) can reinforce the
validity of results.</p>
<p><strong>Note</strong>: Users should carefully consider which control
group makes the most sense for their research question and the available
data. Differences in results between control groups can arise due to
various factors like treatment spillovers, different underlying trends,
or selection into treatment.</p>
</div>
<div class="section level2">
<h2 id="additional-analyses">Additional Analyses<a class="anchor" aria-label="anchor" href="#additional-analyses"></a>
</h2>
<div class="section level3">
<h3 id="did-plot">DID Plot<a class="anchor" aria-label="anchor" href="#did-plot"></a>
</h3>
<p>The most illuminating visual representation in DID analysis features
a plot that contrasts ‘before’ and ‘after’ scenarios for both the
treatment and control groups. In this graph, time serves as the variable
on the x-axis, separating the data into ‘before’ and ‘after’ periods.
The variable determining the group—whether treated or control—is
utilized as the categorizing factor. Meanwhile, the y-axis displays the
estimated values of the dependent variable under study.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate means</span></span>
<span><span class="va">avg_outcomes</span> <span class="op">&lt;-</span> <span class="va">base_did</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">treat</span>, <span class="va">post</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>avg_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'treat'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="co"># Create the visualization</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">avg_outcomes</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">post</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">avg_y</span>, group <span class="op">=</span> <span class="va">treat</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">treat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">treat</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Difference-in-Differences Visualization"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Period"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Average Outcome (y)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span> <span class="op">=</span> <span class="st">"Pre"</span>, <span class="st">"1"</span> <span class="op">=</span> <span class="st">"Post"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span> <span class="op">=</span> <span class="st">"blue"</span>, <span class="st">"1"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>, </span>
<span>                     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span> <span class="op">=</span> <span class="st">"Control"</span>, <span class="st">"1"</span> <span class="op">=</span> <span class="st">"Treated"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span> <span class="op">=</span> <span class="st">"dashed"</span>, <span class="st">"1"</span> <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span>, </span>
<span>                        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span> <span class="op">=</span> <span class="st">"Control"</span>, <span class="st">"1"</span> <span class="op">=</span> <span class="st">"Treated"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/ama_theme.html">ama_theme</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"blank"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>         linetype <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="did_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<p>But you can always go with a more complicated plot</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/" class="external-link">fixest</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"base_did"</span><span class="op">)</span></span>
<span><span class="va">est_did</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html" class="external-link">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html" class="external-link">i</a></span><span class="op">(</span><span class="va">period</span>, <span class="va">treat</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">|</span><span class="va">id</span> <span class="op">+</span> <span class="va">period</span>, <span class="va">base_did</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/coefplot.html" class="external-link">iplot</a></span><span class="op">(</span><span class="va">est_did</span><span class="op">)</span></span></code></pre></div>
<p><img src="did_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mike Nguyen.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
