<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2. Difference-in-Differences • causalverse</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2. Difference-in-Differences">
<meta property="og:description" content="causalverse">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">causalverse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00_introduction.html">Introduction to CausalVerse</a>
    </li>
    <li>
      <a href="../articles/02_did.html">2. Difference-in-Differences</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>2. Difference-in-Differences</h1>
                        <h4 data-toc-skip class="author">Mike
Nguyen</h4>
            
            <h4 data-toc-skip class="date">2023-08-25</h4>
      
      
      <div class="hidden name"><code>02_did.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">causalverse</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="assumptions">Assumptions<a class="anchor" aria-label="anchor" href="#assumptions"></a>
</h2>
<div class="section level3">
<h3 id="pre-treatment-parallel-trends">Pre-treatment Parallel Trends<a class="anchor" aria-label="anchor" href="#pre-treatment-parallel-trends"></a>
</h3>
<div class="section level4">
<h4 id="plot_par_trends">plot_par_trends<a class="anchor" aria-label="anchor" href="#plot_par_trends"></a>
</h4>
<p>The <code>plot_par_trends</code> function is designed to assist
researchers and analysts in visualizing parallel trends in longitudinal
datasets, particularly for datasets with treatment and control groups.
This tool makes it easy to visualize changes over time for various
outcome metrics between the groups.</p>
<p><strong>Data Structure</strong></p>
<p>For optimal use of <code>plot_par_trends</code>, ensure your data is
structured in the following manner:</p>
<ul>
<li>
<code>entity</code>: A unique identifier for each observation (e.g.,
individuals, companies).</li>
<li>
<code>time</code>: The time period for the observation.</li>
<li>Treatment status column: Distinguishing treated observations from
controls.</li>
<li>Metric columns: Capturing the outcome measures of interest.</li>
</ul>
<p><strong>Sample Data Generation</strong></p>
<p>For demonstration purposes, we can generate some illustrative
data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.2     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.4</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.4.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.2     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>entity <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">entity</span>, <span class="va">time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">entity</span> <span class="op">&lt;=</span> <span class="fl">50</span>, <span class="st">"Treated"</span>, <span class="st">"Control"</span><span class="op">)</span>,</span>
<span>    outcome1 <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">"Treated"</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    outcome2 <span class="op">=</span> <span class="fl">3</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="va">time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">"Treated"</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    outcome3 <span class="op">=</span> <span class="fl">3</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">time</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, rate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">"Treated"</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, </span>
<span>    outcome4 <span class="op">=</span> <span class="va">time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">"Treated"</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Visualizing Trends with <code>plot_par_trends</code> Invoke the
<code>plot_par_trends</code> function using the sample data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_par_trends.html">plot_par_trends</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  metrics_and_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>outcome1 <span class="op">=</span> <span class="st">"Outcome 1"</span>, outcome2 <span class="op">=</span> <span class="st">"Outcome 2"</span>, outcome3 <span class="op">=</span> <span class="st">"Outcome 3"</span>, outcome4 <span class="op">=</span> <span class="st">"Outcome 4"</span><span class="op">)</span>,</span>
<span>  treatment_status_var <span class="op">=</span> <span class="st">"treatment"</span>,</span>
<span>  time_var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>time <span class="op">=</span> <span class="st">"Time"</span><span class="op">)</span>,</span>
<span>  smoothing_method <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>  theme_use <span class="op">=</span> <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/ama_theme.html">ama_theme</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span>  <span class="co"># title_prefix = "Para Trends"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Note</strong>: This custom function is built based on the
<code>geom_smooth</code> function from ggplot2. Therefore, it supports
most of the smoothing methods you’d find in ggplot2, such as
<code>lm</code>, <code>glm</code>, <code>loess</code>, etc.</p>
<p>The function returns a list of ggplot objects, which can be
visualized using tools like <code>gridExtra</code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'gridExtra'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     combine</span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">results</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_did_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p><strong>Note of Caution</strong>: When using this custom package,
it’s crucial to carefully examine parallel trends plots both with and
without control variables. At times, one might observe suitable parallel
trends without control variables. However, when these control variables
are introduced, the underlying assumptions can be disturbed. Conversely,
there are cases where the general parallel trends assumption doesn’t
seem to be in place, but when conditioned on the control variables, the
trends align perfectly. This package provides functions that allow users
to easily generate these plots side by side, especially after
formulating the predicted values of dependent variables by accounting
for control variables. Always approach these plots with a discerning eye
to ensure accurate interpretation and application.</p>
<p>In this demonstration, I’ve incorporated the use of the smoothing
function to illustrate its potential application. It’s imperative,
however, to approach this function with prudence. Although the smoothing
function can be invaluable in revealing underlying trends in specific
scenarios, its application carries inherent risks. One such risk is the
inadvertent or intentional misrepresentation of data, leading observers
to falsely deduce the presence of parallel trends where they might not
exist. This can potentially skew interpretations and lead to incorrect
conclusions.</p>
<p>Given these concerns, if you’re inclined to utilize the smoothing
function, it’s paramount to also consider the implications and insights
from our secondary plot. This subsequent visualization offers a more
granular and statistically sound perspective, specifically focusing on
the pre-treatment disparities between the treated and control groups. It
serves as a vital counterbalance, ensuring that any trend
interpretations are grounded in robust statistical analysis.</p>
</div>
<div class="section level4">
<h4 id="plot_coef_par_trends">plot_coef_par_trends<a class="anchor" aria-label="anchor" href="#plot_coef_par_trends"></a>
</h4>
<p>Arguments</p>
<ul>
<li>
<code>data</code>: A data frame containing the data to be used in
the model.</li>
<li>
<code>dependent_vars</code>: A named list of dependent variables to
model along with their respective labels.</li>
<li>
<code>time_var</code>: The name of the time variable in the
data.</li>
<li>(similarly, describe other arguments…)</li>
</ul>
<p>Output</p>
<p>The function returns a plot or a list of plots visualizing
interaction coefficients based on user specifications.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/" class="external-link">fixest</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"base_did"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combined Plot</span></span>
<span><span class="va">combined_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coef_par_trends.html">plot_coef_par_trends</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">base_did</span>,</span>
<span>  dependent_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Outcome 1"</span>, x1 <span class="op">=</span> <span class="st">"Outcome 2"</span><span class="op">)</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"period"</span>,</span>
<span>  unit_treatment_status <span class="op">=</span> <span class="st">"treat"</span>,</span>
<span>  unit_id_var <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  plot_type <span class="op">=</span> <span class="st">"coefplot"</span>,</span>
<span>  combined_plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"Interaction coefficients Plot"</span><span class="op">)</span>,</span>
<span>  legend_title <span class="op">=</span> <span class="st">"Metrics"</span>,</span>
<span>  legend_position <span class="op">=</span> <span class="st">"bottomright"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Notes from the estimations:</span></span>
<span><span class="co">#&gt; [x 2] The variable 'period::10:treat' has been removed because of collinearity (see $collin.var).</span></span></code></pre></div>
<p><img src="02_did_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Individual Plots</span></span>
<span><span class="va">indi_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coef_par_trends.html">plot_coef_par_trends</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">base_did</span>,</span>
<span>  dependent_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Outcome 1"</span>, x1 <span class="op">=</span> <span class="st">"Outcome 2"</span><span class="op">)</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"period"</span>,</span>
<span>  unit_treatment_status <span class="op">=</span> <span class="st">"treat"</span>,</span>
<span>  unit_id_var <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  plot_type <span class="op">=</span> <span class="st">"coefplot"</span>,</span>
<span>  combined_plot <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; The variable 'period::10:treat' has been removed because of collinearity (see $collin.var).</span></span>
<span><span class="co">#&gt; The variable 'period::10:treat' has been removed because of collinearity (see $collin.var).</span></span></code></pre></div>
<p><img src="02_did_files/figure-html/unnamed-chunk-5-2.png" width="700"><img src="02_did_files/figure-html/unnamed-chunk-5-3.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="random-treatment-assignments">Random Treatment Assignments<a class="anchor" aria-label="anchor" href="#random-treatment-assignments"></a>
</h2>
<p>In Difference-in-Differences analysis, ensuring randomness in
treatment assignment is crucial. This randomization comes in two main
levels: random time assignment and random unit assignment.</p>
<ol style="list-style-type: decimal">
<li>
<p><a href="#random-time-assignment">Random Time Assignment</a></p>
<ul>
<li><p><strong>Definition:</strong> This pertains to when (in time) a
treatment or intervention is introduced, not to which units it’s
introduced.</p></li>
<li><p><strong>Importance in Staggered DiD or Rollout Design:</strong>
If certain periods are predisposed to receiving treatment (e.g.,
economic booms or downturns), then the estimated treatment effect can
get confounded with these period-specific shocks. A truly random time
assignment ensures that the treatment’s introduction isn’t
systematically related to other time-specific factors.</p></li>
<li><p><strong>Example:</strong> Suppose there’s a policy aimed at
improving infrastructure. If this policy tends to get introduced during
economic booms because that’s when governments have surplus funds, then
it’s challenging to disentangle the effects of the booming economy from
the effects of the infrastructure policy. A random time assignment would
ensure the policy’s introduction isn’t tied to the state of the
economy.</p></li>
</ul>
</li>
<li>
<p><a href="#random-unit-assignment">Random Unit Assignment</a></p>
<ul>
<li><p><strong>Definition:</strong> This pertains to which units (like
individuals, firms, or regions) are chosen to receive the
treatment.</p></li>
<li><p><strong>Example:</strong> Using the same infrastructure policy,
if it is always introduced in wealthier regions first, then the effects
of regional affluence can get confounded with the policy effects. Random
unit assignment ensures the policy isn’t systematically introduced to
certain kinds of regions.</p></li>
</ul>
</li>
</ol>
<p><strong>Providing Evidence of Random Treatment
Assignments:</strong></p>
<p>To validate the DiD design, evidence should be provided for both
random time and random unit assignments:</p>
<ul>
<li>
<p><strong>For <a href="#random-time-assignment">Random Time
Assignment</a>:</strong></p>
<ul>
<li><p><strong>Graphical Analysis:</strong> Plot the timing of treatment
introduction across various periods. A discernible pattern (like always
introducing a policy before election years) can raise concerns.</p></li>
<li><p><strong>Narrative Evidence:</strong> Historical context might
indicate that the timing of treatment introduction was exogenous. For
example, if a policy’s rollout timing was determined by some external
random event, that would support random time assignment.</p></li>
</ul>
</li>
<li>
<p><strong>For <a href="#random-unit-assignment">Random Unit
Assignment</a>:</strong></p>
<ul>
<li><p><strong>Statistical Tests:</strong> Conduct tests to demonstrate
that pre-treatment characteristics are balanced between the treated and
control groups. Techniques like t-tests or regressions can be used for
this.</p></li>
<li><p><strong>Narrative Evidence:</strong> Institutional or historical
data might show that the selection of specific units for treatment was
random.</p></li>
</ul>
</li>
</ul>
<div class="section level3">
<h3 id="random-time-assignment">Random Time Assignment<a class="anchor" aria-label="anchor" href="#random-time-assignment"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Control number of units and time periods here</span></span>
<span><span class="va">num_units</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span><span class="va">num_periods</span> <span class="op">&lt;-</span> <span class="fl">20</span>  </span>
<span></span>
<span><span class="co"># Setting seed for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate data for given number of units over specified periods</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>unit <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_units</span>, time_period <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_periods</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">treatment_random</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">treatment_systematic</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Randomly assigning treatment times to units</span></span>
<span><span class="va">random_treatment_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num_periods</span>, <span class="va">num_units</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_units</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">treatment_random</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">unit</span> <span class="op">==</span> <span class="va">i</span> <span class="op">&amp;</span> <span class="va">data</span><span class="op">$</span><span class="va">time_period</span> <span class="op">==</span> <span class="va">random_treatment_times</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Calculate peaks robustly</span></span>
<span><span class="va">peak_periods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span> <span class="op">*</span> <span class="va">num_periods</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Systematic treatment assignment with higher probability at peak periods</span></span>
<span><span class="va">prob_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">num_periods</span>, <span class="va">num_periods</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Update the probability for peak periods; the rest will have a slightly reduced probability</span></span>
<span><span class="va">higher_prob</span> <span class="op">&lt;-</span> <span class="fl">0.10</span>  <span class="co"># Arbitrary, adjust as necessary</span></span>
<span><span class="va">prob_values</span><span class="op">[</span><span class="va">peak_periods</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">higher_prob</span></span>
<span><span class="va">adjustment</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">peak_periods</span><span class="op">)</span> <span class="op">*</span> <span class="va">higher_prob</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">peak_periods</span><span class="op">)</span> <span class="op">/</span> <span class="va">num_periods</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">num_periods</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">peak_periods</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">prob_values</span><span class="op">[</span><span class="op">-</span><span class="va">peak_periods</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">num_periods</span> <span class="op">-</span> <span class="va">adjustment</span></span>
<span></span>
<span><span class="va">systematic_treatment_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num_periods</span>, <span class="va">num_units</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="va">prob_values</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_units</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">treatment_systematic</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">unit</span> <span class="op">==</span> <span class="va">i</span> <span class="op">&amp;</span> <span class="va">data</span><span class="op">$</span><span class="va">time_period</span> <span class="op">==</span> <span class="va">systematic_treatment_times</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Aggregate for plotting</span></span>
<span><span class="va">agg_random</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">time_period</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>units_treated <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">treatment_random</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">agg_systematic</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">time_period</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>units_treated <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">treatment_systematic</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting</span></span>
<span><span class="va">plot_random</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">agg_random</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_period</span>, y <span class="op">=</span> <span class="va">units_treated</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Random Time Assignment"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Number of Unit Treated"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/ama_theme.html">ama_theme</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_systematic</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">agg_systematic</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_period</span>, y <span class="op">=</span> <span class="va">units_treated</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Systematic Time Assignment"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Number of Unit Treated"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/ama_theme.html">ama_theme</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">plot_random</span>, <span class="va">plot_systematic</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_did_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p><strong>Random Time Assignment Plot:</strong></p>
<ul>
<li>Treatment is dispersed randomly across time periods, with no clear
pattern.</li>
</ul>
<p><strong>Systematic Time Assignment Plot:</strong></p>
<ul>
<li>Distinct peaks are observed at the 25th, 50th, and 75th periods,
indicating non-random treatment assignment at these times.</li>
</ul>
<p><strong>Interpretation:</strong> The random plot shows arbitrary
treatment assignments, while the systematic plot reveals consistent
periods where more units receive treatment. This systematic behavior can
introduce bias in causal studies.</p>
</div>
<div class="section level3">
<h3 id="random-unit-assignment">Random Unit Assignment<a class="anchor" aria-label="anchor" href="#random-unit-assignment"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<p><strong>For a Single Pre-treatment Characteristic:</strong></p>
<ul>
<li>
<strong>T-test:</strong> This is used for comparing means of the
characteristic between two groups (treated vs. control). If the p-value
is significant (typically &lt; 0.05), it suggests the groups differ on
that characteristic.</li>
</ul>
</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data &lt;- data.frame(treatment = c(rep(0, 50), rep(1, 50)),</span></span>
<span><span class="co">#                    # Dummy for treatment</span></span>
<span><span class="co">#                    characteristic = rnorm(100) # Randomly generated characteristic</span></span>
<span><span class="co">#                    )</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="va">mtcars</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="va">cyl</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span>, replace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span>                   </span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">treatment</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  mpg by treatment</span></span>
<span><span class="co">#&gt; t = 0.81508, df = 29.976, p-value = 0.4215</span></span>
<span><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span><span class="co">#&gt;  -2.575206  5.995841</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span><span class="co">#&gt;        20.83889        19.12857</span></span></code></pre></div>
<ul>
<li>
<strong>Regression:</strong> Run a regression of the pre-treatment
characteristic on the treatment dummy. If the coefficient on the
treatment dummy is significant, it suggests the groups differ on that
characteristic. The regression can be specified as:</li>
</ul>
<p><span class="math display">\[
Characteristic_i = \alpha + \beta \times Treatment_i + \epsilon_i
\]</span></p>
<p>where <span class="math inline">\(Characteristic_i\)</span> is the
pre-treatment characteristic of unit <span class="math inline">\(i\)</span> and <span class="math inline">\(Treatment_i\)</span> is a dummy variable which
equals 1 if <span class="math inline">\(unit_i\)</span> is treated and 0
otherwise.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">treatment</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_result</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = mpg ~ treatment, data = data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -10.439  -4.529  -1.179   2.271  13.061 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   20.839      1.429  14.581 3.72e-15 ***</span></span>
<span><span class="co">#&gt; treatment     -1.710      2.161  -0.792    0.435    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 6.064 on 30 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.02046,    Adjusted R-squared:  -0.01219 </span></span>
<span><span class="co">#&gt; F-statistic: 0.6265 on 1 and 30 DF,  p-value: 0.4348</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><strong>For Multiple Pre-treatment Characteristics:</strong></li>
</ol>
<p><strong>Visualization</strong></p>
<ul>
<li>For both single and multiple characteristics, it can be useful to
visualize the distributions in both groups. Histograms, kernel density
plots, or box plots can be employed to visually assess balance.</li>
<li>It’s important to note that you should consider the pre-treatment
periods.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rlang.r-lib.org" class="external-link">rlang</a></span><span class="op">)</span> </span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'rlang'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:purrr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     %@%, flatten, flatten_chr, flatten_dbl, flatten_int, flatten_lgl,</span></span>
<span><span class="co">#&gt;     flatten_raw, invoke, splice</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Density distribution for a single characteristic</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mpg</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Density Distribution by Treatment Group"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="../reference/ama_theme.html">ama_theme</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_did_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Side-by-side density distributions for multiple characteristics</span></span>
<span><span class="va">plot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_density_by_treatment.html">plot_density_by_treatment</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  var_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"mpg"</span> <span class="op">=</span> <span class="st">"Var 1"</span>,</span>
<span>                 <span class="st">"cyl"</span> <span class="op">=</span> <span class="st">"Var 2"</span><span class="op">)</span>,</span>
<span>  treatment_var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"treatment"</span> <span class="op">=</span> <span class="st">"Treatment Name\nin Legend"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">plot_list</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_did_files/figure-html/unnamed-chunk-9-2.png" width="700"></p>
<p><strong>Multivariate Regression</strong></p>
<p>Run a regression of each pre-treatment characteristic on the
treatment dummy. This allows for the simultaneous assessment of balance
on multiple characteristics. You can include all characteristics in a
single regression as dependent variables.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data$characteristic2 &lt;- rnorm(100)</span></span>
<span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="va">cyl</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_multivariate</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="va">cyl</span><span class="op">)</span> <span class="op">~</span> <span class="va">treatment</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_multivariate</span><span class="op">)</span></span>
<span><span class="co">#&gt; Response mpg :</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = mpg ~ treatment, data = data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -10.439  -4.529  -1.179   2.271  13.061 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   20.839      1.429  14.581 3.72e-15 ***</span></span>
<span><span class="co">#&gt; treatment     -1.710      2.161  -0.792    0.435    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 6.064 on 30 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.02046,    Adjusted R-squared:  -0.01219 </span></span>
<span><span class="co">#&gt; F-statistic: 0.6265 on 1 and 30 DF,  p-value: 0.4348</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Response cyl :</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = cyl ~ treatment, data = data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -2.2857 -2.1111 -0.1111  1.7579  1.8889 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   6.1111     0.4274   14.30 6.21e-15 ***</span></span>
<span><span class="co">#&gt; treatment     0.1746     0.6461    0.27    0.789    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 1.813 on 30 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.002428,   Adjusted R-squared:  -0.03082 </span></span>
<span><span class="co">#&gt; F-statistic: 0.07302 on 1 and 30 DF,  p-value: 0.7888</span></span></code></pre></div>
<p>All of the coefficients in each regression are not significant.
Hence, we don’t have any concerns.</p>
<p>To be more rigorous, we should estimate all regressions
simultaneously using SUR if we suspect the error terms of the different
regression equations are correlated.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("systemfit")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/systemfit/" class="external-link">systemfit</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">equation1</span> <span class="op">&lt;-</span> <span class="va">mpg</span> <span class="op">~</span> <span class="va">treatment</span></span>
<span><span class="va">equation2</span> <span class="op">&lt;-</span> <span class="va">cyl</span> <span class="op">~</span> <span class="va">treatment</span></span>
<span></span>
<span><span class="va">system</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>characteristic <span class="op">=</span> <span class="va">equation1</span>, characteristic2 <span class="op">=</span> <span class="va">equation2</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemfit/man/systemfit.html" class="external-link">systemfit</a></span><span class="op">(</span><span class="va">system</span>, data <span class="op">=</span> <span class="va">data</span>, method <span class="op">=</span> <span class="st">"SUR"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; systemfit results </span></span>
<span><span class="co">#&gt; method: SUR </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         N DF     SSR detRCov   OLS-R2 McElroy-R2</span></span>
<span><span class="co">#&gt; system 64 60 1201.65 32.5288 0.019002   0.020257</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  N DF       SSR      MSE    RMSE       R2    Adj R2</span></span>
<span><span class="co">#&gt; characteristic  32 30 1103.0113 36.76705 6.06358 0.020457 -0.012194</span></span>
<span><span class="co">#&gt; characteristic2 32 30   98.6349  3.28783 1.81324 0.002428 -0.030824</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The covariance matrix of the residuals used for estimation</span></span>
<span><span class="co">#&gt;                 characteristic characteristic2</span></span>
<span><span class="co">#&gt; characteristic        36.76704        -9.39974</span></span>
<span><span class="co">#&gt; characteristic2       -9.39974         3.28783</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The covariance matrix of the residuals</span></span>
<span><span class="co">#&gt;                 characteristic characteristic2</span></span>
<span><span class="co">#&gt; characteristic        36.76704        -9.39974</span></span>
<span><span class="co">#&gt; characteristic2       -9.39974         3.28783</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The correlations of the residuals</span></span>
<span><span class="co">#&gt;                 characteristic characteristic2</span></span>
<span><span class="co">#&gt; characteristic        1.000000       -0.854932</span></span>
<span><span class="co">#&gt; characteristic2      -0.854932        1.000000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SUR estimates for 'characteristic' (equation 1)</span></span>
<span><span class="co">#&gt; Model Formula: mpg ~ treatment</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Estimate Std. Error  t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 20.83889    1.42920 14.58080 3.5527e-15 ***</span></span>
<span><span class="co">#&gt; treatment   -1.71032    2.16075 -0.79154    0.43484    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 6.063584 on 30 degrees of freedom</span></span>
<span><span class="co">#&gt; Number of observations: 32 Degrees of Freedom: 30 </span></span>
<span><span class="co">#&gt; SSR: 1103.011349 MSE: 36.767045 Root MSE: 6.063584 </span></span>
<span><span class="co">#&gt; Multiple R-Squared: 0.020457 Adjusted R-Squared: -0.012194 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SUR estimates for 'characteristic2' (equation 2)</span></span>
<span><span class="co">#&gt; Model Formula: cyl ~ treatment</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Estimate Std. Error  t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 6.111111   0.427384 14.29887 6.2172e-15 ***</span></span>
<span><span class="co">#&gt; treatment   0.174603   0.646144  0.27022    0.78884    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 1.813238 on 30 degrees of freedom</span></span>
<span><span class="co">#&gt; Number of observations: 32 Degrees of Freedom: 30 </span></span>
<span><span class="co">#&gt; SSR: 98.634921 MSE: 3.287831 Root MSE: 1.813238 </span></span>
<span><span class="co">#&gt; Multiple R-Squared: 0.002428 Adjusted R-Squared: -0.030824</span></span></code></pre></div>
<p>For <code>mpg</code> and <code>cyl</code>: The treatment effect is
not statistically significant, implying no evidence against random unit
assignment based on this characteristic.</p>
<p><strong>Hotelling’s T-squared test</strong></p>
<p>This is the multivariate counterpart of the T-test designed to test
the mean vector of two groups. It’s useful when you have multiple
pre-treatment characteristics and you want to test if their mean vectors
differ between the treated and control groups.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For Hotelling's T^2, you can use the `Hotelling` package.</span></span>
<span><span class="co"># install.packages("Hotelling")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jmcurran/Hotelling" class="external-link">Hotelling</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: corpcor</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'Hotelling'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     summarise</span></span>
<span></span>
<span><span class="va">treated_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">treatment</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mpg"</span>, <span class="st">"cyl"</span> <span class="op">)</span><span class="op">]</span></span>
<span><span class="va">control_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">treatment</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mpg"</span>, <span class="st">"cyl"</span> <span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">hotelling_test_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hotelling/man/hotelling.test.html" class="external-link">hotelling.test</a></span><span class="op">(</span><span class="va">treated_data</span>, <span class="va">control_data</span><span class="op">)</span></span>
<span><span class="va">hotelling_test_res</span></span>
<span><span class="co">#&gt; Test stat:  1.2406 </span></span>
<span><span class="co">#&gt; Numerator df:  2 </span></span>
<span><span class="co">#&gt; Denominator df:  29 </span></span>
<span><span class="co">#&gt; P-value:  0.5557</span></span></code></pre></div>
<p><strong>Matching</strong></p>
<p>This is a more advanced technique, for example, modeling the
probability of being treated based on pre-treatment characteristics
using a logistic regression. After matching, you can test for balance in
the pre-treatment characteristics between the treated and control
groups.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For propensity score matching, use the `MatchIt` package.</span></span>
<span><span class="co"># install.packages("MatchIt")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kosukeimai.github.io/MatchIt/" class="external-link">MatchIt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">m.out</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html" class="external-link">matchit</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">~</span> <span class="va">mpg</span> <span class="op">+</span> <span class="va">cyl</span>,</span>
<span>          data <span class="op">=</span> <span class="va">data</span>,</span>
<span>          method <span class="op">=</span> <span class="st">"nearest"</span><span class="op">)</span></span>
<span><span class="va">matched_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/match.data.html" class="external-link">match.data</a></span><span class="op">(</span><span class="va">m.out</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># After matching, you can test for balance using t-tests or regressions.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">treatment</span>, data <span class="op">=</span> <span class="va">matched_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  mpg by treatment</span></span>
<span><span class="co">#&gt; t = -0.035239, df = 25.957, p-value = 0.9722</span></span>
<span><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span><span class="co">#&gt;  -4.238310  4.095453</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span><span class="co">#&gt;        19.05714        19.12857</span></span></code></pre></div>
<p>In conclusion, while visualizations provide an intuitive
understanding, statistical tests provide a more rigorous method for
assessing balance.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mike Nguyen.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
